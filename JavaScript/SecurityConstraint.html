<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/JavaScript/SecurityConstraint.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:16:24 GMT -->
<head>


















  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">







  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/print.css" type="text/css">







  
  
  
  
  
  
  
  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>安全限制</title></head><body>







<h3><a href="../index.html">From
Gossip@Openhome</a></h3>







<h1><a href="index-2.html">JavaScript Essence: 安全限制<br>
</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>

    <tr>

      <td style="vertical-align: top; width: 250px; text-align: center;">
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>

      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br><center> </center></td>

      <td style="vertical-align: top; width: 690px; text-align: left;">
      <div style="text-align: right;"><a href="http://openhome.cc/eGossip/JavaScript/Security.html"><small>English</small></a><br>
      </div>
      <small><br>
JavaScript
可以在瀏覽器執行程式，這就牽涉到許多安全性問題，使用者下載了網頁，下載了JavaScript程式碼偷偷地在執行，有些動作必須加以限制，以免使用者
的電腦遭竊取資料、讀寫或破壞，最基本的，瀏覽器不允許JavaScript對客戶端電腦作檔案存取的動作。</small><br>
      <br>
      <small>安全還有其它許多因素要考量，舉例來說，在過去，瀏覽器上可以設狀態列文字，不過這也會有安全疑慮，因為在某些情況下，使用者可以變造狀態列訊息來欺瞞使用者。例如在滑鼠移到超鏈結時，理應顯示連結的網址，如果透過程式變造顯示的網址，</small><small>使用者就會被誤導。例如：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&lt;html&gt;</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &lt;head&gt;</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; &lt;script type="text/javascript"&gt;</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; window.onload = function() {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; document.getElementById('link').onmouseover = function() {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
window.defaultStatus = 'http://openhome.cc';</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; &lt;/script&gt;</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &lt;/head&gt;</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &lt;body&gt;</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;a id="link" href="http://caterpillar.onlyfun.net"&gt;caterpillar&lt;/a&gt;</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &lt;/body&gt;</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&lt;/html&gt;</span></small><br>
      </div>
      <br>
      <small>有些瀏覽器已取消了<span style="font-family: Courier New,Courier,monospace;">defaultStatus</span>的設定作用，不過在Internet Explorer上還可以用來設定狀態列文字顯示，在上例中，滑鼠移至超鏈結時，由於安全限制，就算在Internet Explorer上也不會顯示設定的文字，而會顯示<span style="font-family: Courier New,Courier,monospace;">href</span>的網址，只有在移開滑鼠時，才會顯示設定的文字。狀態列文字的設定有所疑慮，事實上，新的瀏覽器也不再包括狀態列了（像是Firefox 4、IE9、Chrome等）。</small><br>
      <br>
      <small>使用JavaScript可以另開視窗，不過沒辦法開啟太小的視窗，這是個很理所當然的考量，因為若可以開很小的視窗，使用者沒注意到它，那在這個小視窗中就可以偷偷摸摸作些壞事了。</small><br>
      <br><small>在瀏覽器中基於安全，<span style="font-family: Courier New,Courier,monospace;">&lt;input&gt;的type為file時，你設定的value</span>會被瀏覽器忽略，只能由使用者親自選取檔案。你透過JavaScript來設定檔案選取框的<span style="font-family: Courier New,Courier,monospace;">value</span>值也沒用。</small><br>
      <br>
      <small>那麼，如果想要設定一個按鈕，讓使用者可以清除選取的檔案要怎麼作？透過JavaScript將<span style="font-family: Courier New,Courier,monospace;">value</span>設為空字串是沒用的。不過可以重新要求瀏覽器建立新的選取框。例如：</small><br>
      <ul>
        <li><a href="samples/SecurityConstraint-1.html"><small>SecurityConstraint-1.html</small></a></li>
      </ul>

      
      <pre>&lt;html&gt;<br>  &lt;head&gt;<br>    &lt;script type="text/javascript"&gt;<br>        window.onload = function() {<br>            document.getElementById('clear').onclick = function() {<br>                var fileupload = document.getElementById('fileupload');<br>                fileupload.innerHTML = fileupload.innerHTML;<br>            };<br>        };<br>    &lt;/script&gt;<br>  &lt;/head&gt;<br>  &lt;body&gt;<br>      &lt;div id="fileupload"&gt;&lt;input name="upload" type="file"&gt;&lt;/div&gt;<br>      &lt;button id="clear"&gt;Clear&lt;/button&gt;<br>  &lt;/body&gt;<br>&lt;/html&gt;<br></pre>
      <br>
      <small>在上例中，若你選取了檔案，並按下Clear按鈕時，取得的<span style="font-family: Courier New,Courier,monospace;">innerHTML</span></small><span style="font-family: Courier New,Courier,monospace;">是</span><small style="font-family: Courier New,Courier,monospace;">&lt;input
name="upload" type="file" value="..."&gt;，當它被指定回innerHTML，瀏覽器會重新剖析並忽略value的部份。等於要求瀏覽器丟掉舊的&lt;input
name="upload" type="file"&gt;，建立新的&lt;input name="upload"
type="file"&gt;，在使用者的觀感中，自然就像是清除了選取框的內容。</small><br style="font-family: Courier New,Courier,monospace;">
      <br>
      <small>再舉使用JavaScript取得檔案大小為例，在Firefox、Chrome中，可以透過<code class="jscript plain">files.item(0).size特性來取得檔案大小。例如：<br>
      </code></small>
      <ul>
        <li><small><a href="samples/SecurityConstraint-2.html">SecurityConstraint-2.html</a></small></li>
      </ul>
      <pre>&lt;html&gt;<br>  &lt;head&gt;<br>    &lt;script type="text/javascript"&gt;<br>        window.onload = function() {<br>            document.getElementById('size').onclick = function() {<br>                var size = document.getElementById('upload')<br>                                   .<span style="font-weight: bold;">files.item(0).size</span>;<br>                document.getElementById('console')<br>                        .innerHTML = 'Size: ' + size;<br>            };<br>        };<br>    &lt;/script&gt;<br>  &lt;/head&gt;<br>  &lt;body&gt;<br>      &lt;input id="upload" name="upload" type="file"&gt;&lt;br&gt;<br>      &lt;button id="size"&gt;Size&lt;/button&gt;&lt;br&gt;<br>      &lt;span id="console"&gt;&lt;/span&gt;<br>  &lt;/body&gt;<br>&lt;/html&gt;<br></pre>

      <br>
      <small>在Internet Explorer的話，無法使用以上方法，但在過去（Internet Explorer 6前），可以透過建立<span style="font-family: Courier New,Courier,monospace;">Image或ActiveXObject（Scripting.FileSystemObject）</span>來取得檔案大小，但因安全性問題，在新版Internet Explorer都行不通了。以建立Image物件&#29234;例，在過去可以：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;html&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp; &lt;head&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;script type="text/javascript"&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; window.onload = function() {</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; document.getElementById('size').onclick = function() {</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var img = new Image();</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; img.onload = function() {</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
var size = this.fileSize;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
document.getElementById('console')<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
.innerHTML = 'Size: ' + size;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
img.src = document.getElementById('upload').value;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;/script&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp; &lt;/head&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp; &lt;body&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;input id="upload" name="upload" type="file"&gt;&lt;br&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;button id="size"&gt;Size&lt;/button&gt;&lt;br&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;span id="console"&gt;&lt;/span&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp; &lt;/body&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;/html&gt;</small><br>
      </div>
      <small><br>
現在已行不通，因為這實際上是在進行下載指定檔案的動作，如果可以行的通，指定你電腦中的某個檔案，就可以將之載入<span style="font-family: Courier New,Courier,monospace;">Image</span>物件，之後還可以上傳到伺服器上（在Internet Explorer上，目前沒有現成方式可以取得檔案大小，只能透過像是Flash等其它方式取得）。<br>
      <br>
類似的限制還有iframe。例如：<br>
      </small>
      <ul>
        <li><a href="samples/SecurityConstraint-3.html"><small>SecurityConstraint-3.html</small></a></li>
      </ul>
      <pre>&lt;html&gt;<br>    &lt;head&gt;<br>        &lt;script type="text/javascript"&gt;<br>            window.onload = function() {<br>                alert(window.frames['page'].document.body.innerHTML);<br>            };<br>        &lt;/script&gt;<br>    &lt;/head&gt;<br>    &lt;body&gt;<br>        &lt;iframe id="page" name="page" <br>                src="http://caterpillar.onlyfun.net"&gt;&lt;/iframe&gt;<br>    &lt;/body&gt;<br>&lt;/html&gt;<br></pre>
      <br>
      <small>你可以取得iframe的內容，不過僅限與這個文件有相同來源的其它網頁才可以。若沒有這個限制，如果你是在內部網域，我指定你內部網域中某個內部網站的網址，就可以取得網頁的內容，之後再上傳，也就是說，沒有這個限制，我就可以偷你內部網站中的東西。<br>
      <br>
如果你使用Ajax，所建立的Ajax非同步物件也會有相同的限制，你可以使用非同步物件來取得與文件相同來源的其它網頁，但不同來源的文件是無法取得的。<br>
      <br>
這稱之為<span style="font-weight: bold;">同源策略（Same-origin policy）</span>。文件相同來源指的是，與目前文件的<span style="font-weight: bold;">URL協定</span>、<span style="font-weight: bold;">主機</span>與<span style="font-weight: bold;">埠號</span>相同的其它文件，才可以被JavaScript取得，只要</small><small><span style="font-weight: bold;">URL協定</span>、<span style="font-weight: bold;">主機</span>與<span style="font-weight: bold;">埠號</span>其中一個不同，就不可以取得。例如若目前文件來源為http://caterpillar.onlyfun.net:80/Gossip/demo.html。那麼以下視為不同源...<br>
</small>
      <ul>
        <li><small>https://caterpillar.onlyfun.net:80/Gossip/demo.html（協定不同）</small></li>
        <li><small>http://openhome.cc:80/Gossip/demo.html（主機資訊不同，即使實體機器是同一台）</small></li>
        <li><small>http://192.168.0.1:80/Gossip/demo.html</small><small>（視為主機資訊不同）</small></li>
        <li><small>http://caterpillar.onlyfun.net:8080/Gossip/demo.html（埠號不同）</small></li>
      </ul>
      <small><br>
      <span style="font-family: Courier New,Courier,monospace;">&lt;script&gt;的src</span>可以指定外部URL，來自不同URL的.js檔案，可以在同一個頁面中運作，呼叫彼此變數或函式，但它們可取得的頁面必須是與目前頁面相同來源，而不是與.js檔案相同來源。<br>
      <br>
子網域的文件，預設是不同源，但可以透過<span style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">document.domain</span>設定子網域為同源，document.domain</span>預設就是文件來源，例如若是</small><small>http://caterpillar.onlyfun.net:80/Gossip/demo.html，則<span style="font-family: Courier New,Courier,monospace;">document.domain</span>就是'caterpillar.onlyfun.net'。預設無法存取ooo.onlyfun.net、xxx.onlyfun.net的文件，你可以將<span style="font-family: Courier New,Courier,monospace;">document.domain</span>設定為'onlyfun.net'，如此來自</small><small>ooo.onlyfun.net、xxx.onlyfun.net的文件就會被視為同源，<span style="font-weight: bold;">注意！</span><span style="font-family: Courier New,Courier,monospace; font-weight: bold;">document.domain</span></small><small style="font-weight: bold;">只能設為頂層網域，不能設其它網域。</small><br>
      <small><br>
以上簡介的是一些常見的JavaScript安全議題，實際上還有更多，甚至有些瀏覽器沒限制的，也可能被防毒軟體或防火牆防堵。</small><br><br>
<br>
</td>

    </tr>

  </tbody>
</table>

<br>
<br>

<br>

<br>







<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script></body>
<!-- Mirrored from openhome.cc/Gossip/JavaScript/SecurityConstraint.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:16:24 GMT -->
</html>