<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/Ruby/Self.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:15:42 GMT -->
<head>














  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">







  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/print.css" type="text/css">







  
  
  
  
  
  
  
  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>關於 self</title></head><body>







<h3><a href="../index.html">From
Gossip@Openhome</a></h3>







<h1><a href="index-2.html">Ruby Gossip: 關於 self<br>
</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>

    <tr>

      <td style="vertical-align: top; width: 250px; text-align: center;">
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>

      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br><center> </center></td>

      <td style="vertical-align: top; width: 690px; text-align: left;"><small><span style="font-weight: bold;">在Ruby中，</span><span style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">self代表預設的訊息接收者，不同的範圍或呼叫方式，self</span></span><span style="font-weight: bold;">代表的物件也不相同</span>。在頂層環境中，<span style="font-family: Courier New,Courier,monospace;">self</span>是參考至一個名稱為<span style="font-family: Courier New,Courier,monospace;">main</span>的物件，為<span style="font-family: Courier New,Courier,monospace;">Object</span>的實例：</small><small><br></small>
      
      
      
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">










        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; self.is_a? Object<br>
</span>=&gt; true<span style="font-weight: bold;"><br>
&gt;&gt; self<br>
            </span>=&gt; main<span style="font-weight: bold;"><br>
&gt;&gt; self.instance_of? Object<br>
            </span>=&gt; true<span style="font-weight: bold;"><br>
&gt;&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      </table>
      <br>
      <small>在頂層環境中定義方法，相當於在<span style="font-family: Courier New,Courier,monospace;">Object</span>類別中定義私有實例方法。例如：<br>
</small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">def some</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp; puts "Some"</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">end</small><br>
      </div>
      <small><br>
相當於如下定義：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">class Object</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; def some</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; puts "Some"</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; end</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; private :some</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">end</span></small><br>
      </div>
      <small><br>
      <span style="font-family: Courier New,Courier,monospace; font-weight: bold;">在</span><span style="font-weight: bold;">Ruby</span><span style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">中呼叫方法時沒有指定訊息接收者，那麼預設的訊息接收者就是self</span>，</span></small><small><span style="font-family: Courier New,Courier,monospace;">在頂層環境時，self代表Object實例，也因此在頂層環境中定義的方法，可以在類別、方法之中直接呼叫。<br>
      <br>
</span></small><small><span style="font-family: Courier New,Courier,monospace; font-weight: bold;">不過</span><span style="font-weight: bold;">Ruby</span><span style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">中，private方法不需也不能透過self呼叫。</span>例如：</span></small><small><br></small>
      
      
      
      
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">











        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; def some<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; puts "some"<br>
&gt;&gt; end<br>
</span>=&gt; nil<span style="font-weight: bold;"><br>
&gt;&gt; some<br>
            </span>some<br>
=&gt; nil<span style="font-weight: bold;"><br>
&gt;&gt; self.some<br>
            </span>NoMethodError: private method `some' called for main:Object<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from (irb):13<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from C:/Winware/Ruby192/bin/irb:12:in `&lt;main&gt;'<span style="font-weight: bold;"><br>
&gt;&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      </table>

      <br>
      <small><span style="font-family: Courier New,Courier,monospace;">private方法不需也不能透過self呼叫的唯一例外，是在類別中的方法呼叫指定方法時。例如：</span></small><small><br></small>
      
      
      
      
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">












        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; class Some<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; def initialize(value)<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self.value = value<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; end<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; def value=(v)<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @value = v<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; end<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; private :value=<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; def value<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @value<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; end<br>
&gt;&gt; end<br>
</span>=&gt; nil<span style="font-weight: bold;"><br>
&gt;&gt; s = Some.new(10)<br>
            </span>=&gt; #&lt;Some:0x26eb168 @value=10&gt;<span style="font-weight: bold;"><br>
&gt;&gt; s.value<br>
            </span>=&gt; 10<span style="font-weight: bold;"><br>
&gt;&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      </table>


      <br>
      <small style="font-family: Courier New,Courier,monospace;">在上例的initialize方法中，想呼叫private的value方法將值指定給實例變數@value，由於</small><small>Ruby</small><small style="font-family: Courier New,Courier,monospace;">中若發現=指定，會將值指定給區域變數，為了區別，這種情況下必須使用self明確指定，是要呼叫value()方法，而不是設定區域變數，如果沒有指定self，就會如下：</small><small><br></small>
      
      
      
      
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">













        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; class Some<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; def initialize(value)<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value = value<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; end<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; def value=(v)<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @value = v<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; end<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; private :value=<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; def value<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @value<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; end<br>
&gt;&gt; end<br>
</span>=&gt; nil<span style="font-weight: bold;"><br>
&gt;&gt; s = Some.new(10)<br>
            </span>=&gt; #&lt;Some:0x512208&gt;<span style="font-weight: bold;"><br>
&gt;&gt; s.value<br>
            </span>=&gt; nil<span style="font-weight: bold;"><br>
&gt;&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      </table>



      <br>
      <small style="font-weight: bold;"><span style="font-family: Courier New,Courier,monospace;">在單例方法或實例方法中，self</span></small><small style="font-weight: bold;"><span style="font-family: Courier New,Courier,monospace;">代表</span></small><small><span style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">呼叫方法時逗號左邊的物件</span>。例如：</span></small><small><br></small>
      
      
      
      
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">














        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; obj = Object.new<br>
=&gt; #&lt;Object:0x25f6c80&gt;</span><span style="font-weight: bold;"><br>
&gt;&gt; def obj.self_id<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; self.object_id<br>
&gt;&gt; end<br>
            </span>=&gt; nil<span style="font-weight: bold;"><br>
&gt;&gt; obj.object_id<br>
            </span>=&gt; 19904064<span style="font-weight: bold;"><br>
&gt;&gt; obj.self_id<br>
            </span>=&gt; 19904064<span style="font-weight: bold;"><br>
&gt;&gt; class Some<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; def self_id<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self.object_id<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; end<br>
&gt;&gt; end<br>
            </span>=&gt; nil<span style="font-weight: bold;"><br>
&gt;&gt; s = Some.new<br>
            </span>=&gt; #&lt;Some:0x276e520&gt;<span style="font-weight: bold;"><br>
&gt;&gt; s.object_id<br>
            </span>=&gt; 20673168<span style="font-weight: bold;"><br>
&gt;&gt; s.self_id<br>
            </span>=&gt; 20673168<span style="font-weight: bold;"><br>
&gt;&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      </table>




      <br>
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">在類別本體中，self代表類別本身（也就是Class實例）</span>。例如：</small><small><br></small>
      
      
      
      
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">















        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; class Some<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; puts self.object_id<br>
&gt;&gt; end<br>
</span>19600008<span style="font-weight: bold;"><br>
            </span>=&gt; nil<span style="font-weight: bold;"><br>
&gt;&gt; Some.object_id<br>
            </span>=&gt; 19600008<span style="font-weight: bold;"><br>
&gt;&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      </table>





      <br>
      <small>所以，在定義類別方法時，可以使用<span style="font-family: Courier New,Courier,monospace;">self</span>代替具體的類別名稱。例如：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">class Some</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; def Some.action</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; puts "Some.action"</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; end</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">end</span></small><br>
      </div>
<br>
      <small>可以改用以下的寫法，如此以後修改類別名稱，就不用特別再修改類別方法前的名稱：</small><br>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">class Some</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; def self.action</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; puts "Some.action"</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; end</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">end</span></small><br>
      </div>




      <br>
      <small>在 </small><small><big><a href="ClassMethod.html"><small>單例方法、實例方法、類別方法</small></a></big> 中談過，</small><small>類別方法實際上是類別的單例方法，所以在類別方法中，<span style="font-family: Courier New,Courier,monospace;">self就是代表類別。例如：</span></small><small><br></small>
      
      
      
      
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">
















        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; class Some<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; def self.self_id<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self.object_id<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; end<br>
&gt;&gt; end<br>
</span>=&gt; nil<span style="font-weight: bold;"><br>
&gt;&gt; Some.object_id<br>
            </span>=&gt; 18863088<span style="font-weight: bold;"><br>
&gt;&gt; Some.self_id<br>
            </span>=&gt; 18863088<span style="font-weight: bold;"><br>
&gt;&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      </table>






      <br>
      <br>
      <br>
<br>
</td>

    </tr>

  </tbody>
</table>

<br>
<br>

<br>

<br>







<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script></body>
<!-- Mirrored from openhome.cc/Gossip/Ruby/Self.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:15:42 GMT -->
</html>