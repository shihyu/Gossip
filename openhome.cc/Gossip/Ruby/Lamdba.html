<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/Ruby/Lamdba.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:15:42 GMT -->
<head>














  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">







  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/print.css" type="text/css">







  
  
  
  
  
  
  
  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>使用 lambda</title></head><body>







<h3><a href="../index.html">From
Gossip@Openhome</a></h3>







<h1><a href="index-2.html">Ruby Gossip: 使用 lambda<br>
</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>

    <tr>

      <td style="vertical-align: top; width: 250px; text-align: center;">
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>
<script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br><center> </center></td>

      <td style="vertical-align: top; width: 690px; text-align: left;"><small>在</small> <small><big><a href="BlockProc.html"><small>程式區塊與 Proc</small></a></big> 中談過，<span style="font-family: Courier New,Courier,monospace;">Proc</span>物件像是個程式流程片段，有時候，你希望的是程式區塊更像是個方法呼叫，這時可以使用<span style="font-family: Courier New,Courier,monospace;">lambda</span>方法。例如：</small><br>



      
      
      <table style="text-align: left; width: 100%; font-family: Courier New,Courier,monospace;" border="0" cellpadding="2" cellspacing="2">











        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; def some(lda)<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; puts "some 1"<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; lda.call<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp; puts "some 2"<br>
&gt;&gt; end<br>
</span>=&gt; nil<span style="font-weight: bold;"><br>
&gt;&gt; lda = lambda { puts "執行 lambda"; return 1 }<br>
            </span>=&gt; #&lt;Proc:0x2161320@(irb):38 (lambda)&gt;<span style="font-weight: bold;"><br>
&gt;&gt; some(lda)<br>
            </span>some 1<br>
執行 lambda<br>
some 2<br>
=&gt; nil<br>
            <span style="font-weight: bold;">&gt;&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      
      
      
      </table>






      <br>
      <small>上例就像是：</small><br>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">def some</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; def lda</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; puts "執行 lambda"</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; end</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; puts "some 1"</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; lda</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; puts "some 2"</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">end</span></small><br>
      </div>
      <br>
      <small>然而你仔細觀察，使用<span style="font-family: Courier New,Courier,monospace;">lambda</span>方法傳回的物件，其實也是<span style="font-family: Courier New,Courier,monospace;">Proc</span>實例：</small><br>
      <div style="margin-left: 40px; font-family: Courier New,Courier,monospace;"><small><span style="font-weight: bold;">&gt;&gt; lda = lambda { puts "執行 lambda"; return 1 }</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">=&gt; #&lt;Proc:0x2161320@(irb):38 (lambda)&gt;</span><br style="font-weight: bold;">
      </small></div>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">lambda與
直接使用Proc.new建立的物件不同的地方在於，Proc.new直接建立的物件像個程式流程，而lambda方法建立的Proc物件像是個方法，因
此lambda建立時的程式區塊return，就像是個方法return，另外，lambda建立的Proc物件，有哪些區塊參數，call就只能傳入幾
個引數。例如：</small><br>




      
      
      <table style="text-align: left; width: 100%; font-family: Courier New,Courier,monospace;" border="0" cellpadding="2" cellspacing="2">












        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; l = lambda { |a, b| puts a, b }<br>
</span>=&gt; #&lt;Proc:0x27fffa8@(irb):17 (lambda)&gt;<span style="font-weight: bold;"><br>
&gt;&gt; l.call(1, 2)</span><br>
1<br>
2<br>
=&gt; nil<span style="font-weight: bold;"><br>
&gt;&gt; l.call(1)</span><br>
ArgumentError: wrong number of arguments (1 for 2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from (irb):17:in `block in irb_binding'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from (irb):19:in `call'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from (irb):19<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from C:/Winware/Ruby192/bin/irb:12:in `&lt;main&gt;'<span style="font-weight: bold;"><br>
&gt;&gt; l.call(1, 2, 3)</span><br>
ArgumentError: wrong number of arguments (3 for 2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from (irb):17:in `block in irb_binding'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from (irb):20:in `call'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from (irb):20<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from C:/Winware/Ruby192/bin/irb:12:in `&lt;main&gt;'<span style="font-weight: bold;"><br>
&gt;&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      
      
      
      </table>







      <br>
      <small style="font-family: Courier New,Courier,monospace;">因此lambda建立的Proc物件，在概念上就類似其它程式語言的一級函式物件，因此在</small><small>Ruby 1.9</small><small style="font-family: Courier New,Courier,monospace;">之後，直接使用語法支援lambda方法建立的Proc物件。例如：</small><br>





      
      
      <table style="text-align: left; width: 100%; font-family: Courier New,Courier,monospace;" border="0" cellpadding="2" cellspacing="2">













        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; l = -&gt;(a, b) { puts a, b }<br>
</span>=&gt; #&lt;Proc:0x2468880@(irb):21 (lambda)&gt;<span style="font-weight: bold;"><br>
&gt;&gt; l.call(10, 20)<br>
            </span>10<br>
20<br>
=&gt; nil<span style="font-weight: bold;"><br>
&gt;&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      
      
      
      </table>








      <br>
      <small style="font-family: Courier New,Courier,monospace;">圓括號中可以指定參數，若不需要參數，則圓括號可以省略。由於lambda建立的也是Proc物件，所以適用程式區塊的方法，也可以使用lambda建立的Proc物件。例如：</small><br>






      
      
      <table style="text-align: left; width: 100%; font-family: Courier New,Courier,monospace;" border="0" cellpadding="2" cellspacing="2">














        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; [1, 2, 3].each(&amp;-&gt;(element) { puts element })<br>
</span>1<br>
2<br>
3<br>
=&gt; [1, 2, 3]<span style="font-weight: bold;"><br>
&gt;&gt;</span><span style="font-weight: bold;"></span></span></small></td></tr></tbody>
      </table>

      <br>
      <small style="font-family: Courier New,Courier,monospace;">不過這並不是lambda最主要的用途，由於lambda建立的Proc物件更像是個方法，所以你可以將之自由傳遞，也可以從方法中返回，而不用擔心return的問題</small><small style="font-family: Courier New,Courier,monospace;">。</small><small>一個例子像是 </small><small><a href="../AlgorithmGossip/GCDPNumber.htm">因
式分解</a>，可以先準備好一定長度的質數表，之後利用該質數表來進行因式分解。例如：<br>
      </small>
      <pre># encoding: Big5<br>class Range<br>    def comprehend(&amp;block)<br>        return self if block.nil?<br>        self.collect(&amp;block).compact<br>    end<br>end<br><br>def prepare_factor(max)<br>    prime = Array.new(max, 1)<br>    2.upto(Math.sqrt(max).to_i - 1) do |i|<br>        if prime[i] == 1<br>            (2 * i).upto(max - 1) do |j|<br>                if j % i == 0<br>                    prime[j] = 0<br>                end<br>            end<br>        end<br>    end<br>    <br>    primes = (2..max - 1).comprehend { |i| i if prime[i] == 1} # 質數表<br><br><span style="font-weight: bold;">    -&gt;(num) {</span><br style="font-weight: bold;"><span style="font-weight: bold;">        list = []</span><br style="font-weight: bold;"><span style="font-weight: bold;">        i = 0</span><br style="font-weight: bold;"><span style="font-weight: bold;">        while primes[i] ** 2 &lt;= num</span><br style="font-weight: bold;"><span style="font-weight: bold;">            if num % primes[i] == 0</span><br style="font-weight: bold;"><span style="font-weight: bold;">                list &lt;&lt; primes[i]</span><br style="font-weight: bold;"><span style="font-weight: bold;">                num /= primes[i]</span><br style="font-weight: bold;"><span style="font-weight: bold;">            else</span><br style="font-weight: bold;"><span style="font-weight: bold;">                i += 1</span><br style="font-weight: bold;"><span style="font-weight: bold;">            end</span><br style="font-weight: bold;"><span style="font-weight: bold;">        end</span><br style="font-weight: bold;"><span style="font-weight: bold;">        list &lt;&lt; num</span><br style="font-weight: bold;"><span style="font-weight: bold;">        f = Array.new(list.length, 0)</span><br style="font-weight: bold;"><span style="font-weight: bold;">        f.length.times { |i|</span><br style="font-weight: bold;"><span style="font-weight: bold;">            f[i] = list[i]</span><br style="font-weight: bold;"><span style="font-weight: bold;">        }</span><br style="font-weight: bold;"><span style="font-weight: bold;">        return f # 在這邊return是可以不寫的，只是為了強調</span><br style="font-weight: bold;"><span style="font-weight: bold;">    }</span><br>end<br><br>factor = prepare_factor(1000)<br>p factor.call(100)  # 顯示 [2, 2, 5, 5]<br>p factor.call(500)  # 顯示 [2, 2, 5, 5, 5]<br>p factor.call(800)  # 顯示 [2, 2, 2, 2, 2, 5, 5]<br></pre>
      <small style="font-family: Courier New,Courier,monospace;"><br>
當然，如果就這個例子，使用Proc.new直接建立粗體字部份，也可以解決問題：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">def prepare_factor(max)</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; ...</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; Proc.new { |num|</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list = []</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i = 0</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while primes[i] ** 2 &lt;= num</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if num % primes[i] == 0</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list &lt;&lt; primes[i]</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; num /= primes[i]</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i += 1</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list &lt;&lt; num</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f = Array.new(list.length, 0)</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f.length.times { |i|</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f[i] = list[i]</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; }</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">end</span></small><br>
      </div>
      <small style="font-family: Courier New,Courier,monospace;"><br>
      <br>
      </small><small>對於一開始就使用Ruby的開發人員而言，程式區塊與<span style="font-family: Courier New,Courier,monospace;">Proc.new</span>直接建立物件，確實減少了使用<span style="font-family: Courier New,Courier,monospace;">lambda</span>的需求，</small><small style="font-family: Courier New,Courier,monospace;">然
而就熟悉一級函式物件的開發人員而言，對於Proc.new直接建立的物件比較像個程序而不是個方法，以及return的微妙處理方式可能不是那麼熟悉，
使用lambda對他們而言會比較容易掌握，Proc.new直接建立的物件，對他們而言會是另一個選項，多了一份彈性。<br>
      <br>
      </small><br>
</td>

    </tr>

  </tbody>
</table>

<br>
<br>

<br>

<br>







<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script></body>
<!-- Mirrored from openhome.cc/Gossip/Ruby/Lamdba.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:15:42 GMT -->
</html>