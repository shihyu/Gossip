<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/ServletJSP/DeclarativeSecurityBasic.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:17:28 GMT -->
<head>

















  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">







  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/print.css" type="text/css">







  
  
  
  
  
  
  
  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>宣告式基本驗證</title></head><body>







<h3><a href="../index.html">From
Gossip@Openhome</a></h3>







<h1><a href="index-2.html">Servlet/JSP Gossip: 宣告式基本驗證<br>
</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>

    <tr>

      <td style="vertical-align: top; width: 250px; text-align: center;"><script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br>
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>

      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br><center> </center></td>

      <td style="vertical-align: top; width: 690px; text-align: left;"><small>如果打算讓Web容器提供基本驗證的功能，則可以在web.xml中定義：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;login-config&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;auth-method&gt;BASIC&lt;/auth-method&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;/login-config&gt;</small><br>
      </div>
      <small><br>
接著要授予指定角色存取頁面的權限，所以要先定義角色。之前說過，目前不知道這個應用程式將部署到哪個伺服器上，所以也無法預測會有哪些使用者名稱與群
組，所以在進行授權管理前，無法根據使用者名稱或群組來進行授權，而是根據角色。所以在授權之前，必須定義這個應用程式中，有哪些角色名稱。可以在
web.xml中如下定義：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;security-role&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;role-name&gt;admin&lt;/role-name&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;role-name&gt;manager&lt;/role-name&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;/security-role&gt;</small><br>
      </div>
      <small><br>
在這邊定義了<span style="font-family: Courier New,Courier,monospace;">admin與manager</span>兩個角色名稱。接著定義哪些URL可以被哪些角色以哪種HTTP方法存取。例如，設定<span style="font-family: Courier New,Courier,monospace;">/admin</span>下所有頁面，無論使用哪個HTTP方法，都只能被admin角色存取：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;security-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;web-resource-collection&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;web-resource-name&gt;Admin&lt;/web-resource-name&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;/web-resource-collection&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;auth-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;role-name&gt;admin&lt;/role-name&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;/auth-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;/security-constraint&gt;</small><br>
      </div>
      <small><br>
如果有多個角色可以存取，則<span style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&lt;auth-constraint</span>&gt;標籤中可以設置多個<span style="font-weight: bold;">&lt;role-name&gt;</span></span>標籤。在這邊看不到任何HTTP方法規範的定義，預設就是所有HTTP方法都受到限制。再來看另一個例子：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&lt;security-constraint&gt;</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp; &lt;web-resource-collection&gt;</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;web-resource-name&gt;Manager&lt;/web-resource-name&gt;</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;url-pattern&gt;/manager/*&lt;/url-pattern&gt;</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;http-method&gt;GET&lt;/http-method&gt;</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;http-method&gt;POST&lt;/http-method&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;http-method-omission&gt;TRACE&lt;/http-method-omission&gt;<br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
</small>
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp; &lt;/web-resource-collection&gt;</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp; &lt;auth-constraint&gt;</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;role-name&gt;admin&lt;/role-name&gt;</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;role-name&gt;manager&lt;/role-name&gt;</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp; &lt;/auth-constraint&gt;</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&lt;/security-constraint&gt;</small><br>
      </div>
      <small><br>
在這個設定中，對於<span style="font-family: Courier New,Courier,monospace;">/manager下的所有頁面，根據<span style="font-weight: bold;">&lt;http-method&gt;</span>的設定，只有admin或manager</span>才可以使用GET與POST方法進行存取，而TRACE完全不允許存取。請留意這個語義，這表示，除了GET、POST、TRACE受約束外，其它HTTP方法，如<span style="font-family: Courier New,Courier,monospace;">PUT、DELETE、HEAD與OPTIONS等，無論是否具備admin或manager</span>角色，都可以存取！<br>
      <br>
沒有設定<span style="font-family: Courier New,Courier,monospace;">&lt;http-method&gt;，
則所有HTTP方法都會受到限制。設定了&lt;http-method&gt;，則只有被設定的HTTP方法受到限制，其它方法則不受限制。另外，如果
沒有設定&lt;auth-constraint&gt;標籤，或是&lt;auth-constraint&gt;標籤中設定<span style="font-weight: bold;">&lt;role-name&gt;*&lt;/role-name&gt;</span>，表示任何角色都可以存取。如果直接撰寫<span style="font-weight: bold;">&lt;auth-constraint/&gt;</span>，那就沒有任何角色可以存取了。</span><br>
      <br>
以下是個完整的設定範例：<br>
      </small>
      <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"<br>xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br>xsi:schemaLocation="http://java.sun.com/xml/ns/javaee<br>http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;<br>    &lt;session-config&gt;<br>        &lt;session-timeout&gt;<br>            30<br>        &lt;/session-timeout&gt;<br>    &lt;/session-config&gt;<br>    &lt;welcome-file-list&gt;<br>        &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;<br>    &lt;/welcome-file-list&gt;<br style="font-weight: bold;"><span style="font-weight: bold;">    &lt;security-constraint&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">        &lt;web-resource-collection&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">            &lt;web-resource-name&gt;Admin&lt;/web-resource-name&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">            &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">        &lt;/web-resource-collection&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">        &lt;auth-constraint&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">            &lt;role-name&gt;admin&lt;/role-name&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">        &lt;/auth-constraint&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">    &lt;/security-constraint&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">    &lt;security-constraint&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">        &lt;web-resource-collection&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">            &lt;web-resource-name&gt;Manager&lt;/web-resource-name&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">            &lt;url-pattern&gt;/manager/*&lt;/url-pattern&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">            &lt;http-method&gt;GET&lt;/http-method&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">            &lt;http-method&gt;POST&lt;/http-method&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">        &lt;/web-resource-collection&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">        &lt;auth-constraint&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">            &lt;role-name&gt;admin&lt;/role-name&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">            &lt;role-name&gt;manager&lt;/role-name&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">        &lt;/auth-constraint&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">    &lt;/security-constraint&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">    &lt;login-config&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">        &lt;auth-method&gt;BASIC&lt;/auth-method&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">    &lt;/login-config&gt;</span><br style="font-weight: bold;"><span style="font-weight: bold;">    &lt;security-role&gt;<br>        &lt;role-name&gt;admin&lt;/role-name&gt;<br>    &lt;/security-role&gt;<br>    &lt;security-role&gt;<br>        &lt;role-name&gt;manager&lt;/role-name&gt;<br>    &lt;/security-role&gt;</span><span style="font-weight: bold;"></span><br>&lt;/web-app&gt; <br></pre>
      <small>
      <br>
就Web應用程式的設定部份，工作已經結束！但在將應用程式部署至伺服器時，得在伺服器上設定角色與使用者或群組的對應，設定的方式並非Java
EE的標準，而是各伺服器而有所不同。例如在Tomcat，可以在conf/tomcat-users.xml中定義：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;?xml version='1.0' encoding='utf-8'?&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;tomcat-users&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp; &lt;role rolename="manager"/&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp; &lt;role rolename="admin"/&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp; &lt;user username="caterpillar" password="123456" roles="admin,manager"/&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp; &lt;user username="momor" password="654321" roles="manager "/&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;/tomcat-users&gt;</small><br>
      </div>
      <small><br>
在這個設定中，<span style="font-family: Courier New,Courier,monospace;">caterpillar
同時具備有admin與manager角色，而momor則具備有manager角色。在啟動應用程式之後，如果存取/admin或/manager，就
會出現對話方塊要求輸入名稱、密碼。如果輸入錯誤，就會被一直要求輸入正確的名稱、密碼。如果取消輸入，則會出現以下的畫面：</span></small><span style="font-family: Courier New,Courier,monospace;"></span><br>
      <img style="width: 642px; height: 293px;" alt="" src="images/DeclarativeSecurityBasic-1.png"><br>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">如果存取
/admin下的頁面，只有輸入caterpillar名稱及正確的密碼，才可以正確觀看到頁面。如果存取/admin下的頁面，輸入了momor及正確
密碼，雖然而可以通過驗證，但momor只有manager角色的權限，無法觀看admin角色才可以存取的頁面，所以會出現拒絕存取的畫面：<br>
      <img style="width: 664px; height: 360px;" alt="" src="images/DeclarativeSecurityBasic-2.png"><br>
      </small><br>
      <br style="font-family: Courier New,Courier,monospace;">
      <br>
<br>
<br>
</td>

    </tr>

  </tbody>
</table>

<br>
<br>

<br>

<br>







<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script></body>
<!-- Mirrored from openhome.cc/Gossip/ServletJSP/DeclarativeSecurityBasic.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:17:29 GMT -->
</html>