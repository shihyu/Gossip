<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<!-- Mirrored from openhome.cc/Gossip/Qt3Gossip/QProgressBar.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:22:50 GMT -->
<head>








  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">








  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/print.css" type="text/css">








  
  
  
  
  
  
  
  <meta content="text/html; charset=Big5" http-equiv="content-type">







  
  
  
  
  
  
  
  <title>使用 QProgressBar</title>
</head>


<body>








<h3><a href="../index.html">From
Gossip@Openhome</a></h3>








<h1><a href="index.html">Qt3 Gossip: 使用 QProgressBar</a></h1>








<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">








  <tbody>








    <tr>








      <td style="width: 676px; vertical-align: top;"> <small>QProgressBar常用來顯示目前的工作進度，例如程式安裝、檔案複製、下載等，這個範例取自Qt的線上說明範例，功能為示範QProgressBar的作用、練習如何取得QRadioButton的狀態，以及如何設定QTimer的執行時間等。 <br>


      <br>


這個程式會配置三個單選鈕、兩個按鈕與一個進度顯示，選擇不同速度的選項再按下按鈕，進度顯示的進度會有不同速度的顯示。 <br>


      <br>


首先編輯定義檔progressbar.h： <br>


      </small>
      
      
      <ul>


        <li>progressbar.h</li>


      
      
      </ul>


      
      
      <pre>#ifndef PROGRESSBAR_H<br>#define PROGRESSBAR_H<br><br>#include &lt;qbuttongroup.h&gt;<br>#include &lt;qtimer.h&gt;<br><br>class QRadioButton;<br>class QPushButton;<br>class QProgressBar;<br><br>class ProgressBar : public QButtonGroup<br>{<br>    Q_OBJECT<br><br>public:<br>    ProgressBar( QWidget *parent = 0, const char *name = 0 );<br><br>protected:<br>    QRadioButton *slow, *normal, *fast;<br>    QPushButton *start, *pause, *reset;<br>    QProgressBar *progress;<br>    QTimer timer;<br><br>protected slots:<br>    void slotStart();<br>    void slotReset();<br>    void slotTimeout();<br><br>};</pre>


      <small><br>


其中slotStart()用來開始QProgressBar，slotReset()用來重置程式的狀態，而slotTimeout()在QTimer設定的時間計時完畢後會執行，這些都將使用Signal - Slot機制來呼叫。 <br>


      <br>


再來編輯qprogressbar.cpp： <br>


      </small>
      
      
      <ul>


        <li>qprogressbar.cpp</li>


      
      
      </ul>


      
      
      <pre>#include "progressbar.h"<br><br>#include &lt;qradiobutton.h&gt;<br>#include &lt;qpushbutton.h&gt;<br>#include &lt;qprogressbar.h&gt;<br>#include &lt;qlayout.h&gt;<br><br>#include &lt;qmotifstyle.h&gt;<br><br>/*<br>* Constructor<br>*<br>* Creates child widgets of the ProgressBar widget<br>*/<br><br>ProgressBar::ProgressBar( QWidget *parent, const char *name )<br>    : QButtonGroup( 0, Horizontal, "Progress Bar", parent, name ), timer()<br>{<br>    setMargin( 10 );<br><br>    QGridLayout* toplayout = new QGridLayout( layout(), 2, 2, 5);<br><br>    setRadioButtonExclusive( TRUE );<br><br>    // insert three radiobuttons which the user can use<br>    // to set the speed of the progress and two pushbuttons<br>    // to start/pause/continue and reset the progress<br>    slow = new QRadioButton( "S&amp;low", this );<br>    normal = new QRadioButton( "&amp;Normal", this );<br>    fast = new QRadioButton( "&amp;Fast", this );<br>    QVBoxLayout* vb1 = new QVBoxLayout;<br>    toplayout-&gt;addLayout( vb1, 0, 0 );<br>    vb1-&gt;addWidget( slow );<br>    vb1-&gt;addWidget( normal );<br>    vb1-&gt;addWidget( fast );<br><br>    // two push buttons, one for start, for for reset.<br>    start = new QPushButton( "&amp;Start", this );<br>    reset = new QPushButton( "&amp;Reset", this );<br>    QVBoxLayout* vb2 = new QVBoxLayout;<br>    toplayout-&gt;addLayout( vb2, 0, 1 );<br>    vb2-&gt;addWidget( start );<br>    vb2-&gt;addWidget( reset );<br><br>    // Create the progressbar<br>    progress = new QProgressBar( 100, this );<br>    //    progress-&gt;setStyle( new QMotifStyle() );<br>    toplayout-&gt;addMultiCellWidget( progress, 1, 1, 0, 1 );<br><br>    // connect the clicked() SIGNALs of the pushbuttons to SLOTs<br>    connect( start, SIGNAL( clicked() ), this, SLOT( slotStart() ) );<br>    connect( reset, SIGNAL( clicked() ), this, SLOT( slotReset() ) );<br><br>    // connect the timeout() SIGNAL of the progress-timer to a SLOT<br>    connect( &amp;timer, SIGNAL( timeout() ), this, SLOT( slotTimeout() ) );<br><br>    // Let's start with normal speed...<br>    normal-&gt;setChecked( TRUE );<br><br><br>    // some contraints<br>    start-&gt;setFixedWidth( 80 );<br>    setMinimumWidth( 300 );<br>}<br><br>/*<br>* SLOT slotStart<br>*<br>* This SLOT is called if the user clicks start/pause/continue<br>* button<br>*/<br><br>void ProgressBar::slotStart()<br>{<br>    // If the progress bar is at the beginning...<br>    if ( progress-&gt;progress() == -1 ) {<br>        // ...set according to the checked speed-radiobutton<br>        // the number of steps which are needed to complete the process<br>        if ( slow-&gt;isChecked() )<br>            progress-&gt;setTotalSteps( 10000 );<br>        else if ( normal-&gt;isChecked() )<br>            progress-&gt;setTotalSteps( 1000 );<br>        else<br>            progress-&gt;setTotalSteps( 50 );<br><br>        // disable the speed-radiobuttons<br>        slow-&gt;setEnabled( FALSE );<br>        normal-&gt;setEnabled( FALSE );<br>        fast-&gt;setEnabled( FALSE );<br>    }<br><br>    // If the progress is not running...<br>    if ( !timer.isActive() ) {<br>        // ...start the timer (and so the progress) with a interval of 1 ms...<br>        timer.start( 1 );<br>        // ...and rename the start/pause/continue button to Pause<br>        start-&gt;setText( "&amp;Pause" );<br>    } else { // if the prgress is running...<br>        // ...stop the timer (and so the prgress)...<br>        timer.stop();<br>        // ...and rename the start/pause/continue button to Continue<br>        start-&gt;setText( "&amp;Continue" );<br>    }<br>}<br><br>/*<br>* SLOT slotReset<br>*<br>* This SLOT is called when the user clicks the reset button<br>*/<br><br>void ProgressBar::slotReset()<br>{<br>    // stop the timer and progress<br>    timer.stop();<br><br>    // rename the start/pause/continue button to Start...<br>    start-&gt;setText( "&amp;Start" );<br>    // ...and enable this button<br>    start-&gt;setEnabled( TRUE );<br><br>    // enable the speed-radiobuttons<br>    slow-&gt;setEnabled( TRUE );<br>    normal-&gt;setEnabled( TRUE );<br>    fast-&gt;setEnabled( TRUE );<br><br>    // reset the progressbar<br>    progress-&gt;reset();<br>}<br><br>/*<br>* SLOT slotTimeout<br>*<br>* This SLOT is called each ms when the timer is<br>* active (== progress is running)<br>*/<br><br>void ProgressBar::slotTimeout()<br>{<br>    int p = progress-&gt;progress();<br><br>#if 1<br>    // If the progress is complete...<br>    if ( p == progress-&gt;totalSteps() )  {<br>        // ...rename the start/pause/continue button to Start...<br>        start-&gt;setText( "&amp;Start" );<br>        // ...and disable it...<br>        start-&gt;setEnabled( FALSE );<br>        // ...and return<br>        return;<br>    }<br>#endif<br><br>    // If the process is not complete increase it<br>    progress-&gt;setProgress( ++p );<br>} </pre>


      <small><br>


最後編輯主函式main.cpp： <br>


      </small>
      
      
      <ul>


        <li><small>main.cpp</small></li>


      
      
      </ul>


      
      
      <pre>#include "progressbar.h"<br>#include &lt;qapplication.h&gt;<br><br>int main(int argc,char **argv)<br>{<br>    QApplication a(argc,argv);<br><br>    ProgressBar progressbar;<br>    progressbar.setCaption("Qt Example - ProgressBar");<br>    a.setMainWidget(&amp;progressbar);<br>    progressbar.show();<br><br>    return a.exec();<br>} </pre>


      <small><br>


同樣的，程式碼很長，但主要還是花費在配置上（視窗程式都是如此），而一些判斷語法其實也不難，只要知道各個元件的幾個方法是什麼作用，就可以簡單的解讀這個程式了；以下我們解說一些重要的語法與方法，</small><small>layout()是由QLayout所繼承下來的方法，它會傳回目前類別的Layout，我們將使用2x2的QGridLayout版面配置，spacing設定為5</small><small>： <br>


      </small>
      
      
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">QGridLayout* toplayout = new QGridLayout( layout(), 2, 2, 5); </span></small><br>


      </div>


      <small><br>


      </small><small>到以下這兩行前的程式碼主要都是有作版面配置，希望您已經可以自行看懂了，因為這之前都說明過了；以下這兩行我們將QProgressBar設定為最大進度100%，並將其橫跨在QGridLayout的(1, 1)與(0, 1)兩個Grid上：</small><br style="font-weight: bold;">


      
      
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">progress = new QProgressBar( 100, this ); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">toplayout-&gt;addMultiCellWidget( progress, 1, 1, 0, 1 ); </span></small><br>


      </div>


      <small><br>


下面這三行不用說都知道在作Signals與Slots的連接，其中Signal - timeout()是QTimer計時逾期時所發出的Signal，這與我們之前範例使用QTimerEvent的方式有所不同：</small><br style="font-weight: bold;">


      
      
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">// connect the clicked() SIGNALs of the pushbuttons to SLOTs </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">connect( start, SIGNAL( clicked() ), this, SLOT( slotStart() ) ); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">connect( reset, SIGNAL( clicked() ), this, SLOT( slotReset() ) ); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">// connect the timeout() SIGNAL of the progress-timer to a SLOT </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">connect( &amp;timer, SIGNAL( timeout() ), this, SLOT( slotTimeout() ) ); </span></small><br>


      </div>


      <small></small><small><br>


我們可以使用QProgressBar的progress()方法來取得它目前的進度狀態，在QRadioButton方面，我們
使用isChecked() 來測試其是否在選取狀態；在這個程式中，我們使用一個QTimer不斷發出Signal -
timerout()，時間間隔設定為1毫秒（0.001秒）發出一次，而藉由設定QProgressBar的Step，使得Step總計數不同，所以相
對的在相同的時間間隔下，每完成一個Step的進度就不同，所以可以製作出不同速度的進行表示：</small><br style="font-weight: bold;">


      
      
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">// If the progress bar is at the beginning... </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">if ( progress-&gt;progress() == -1 ) { </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; // ...set according to the checked speed-radiobutton </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; // the number of steps which are needed to complete the process </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; if ( slow-&gt;isChecked() ) </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; progress-&gt;setTotalSteps( 10000 ); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">.... </span></small><br>


      </div>


      <small><br>


QTimer的isActive()方法可用來測試QTimer是否啟動，start()方法會放動QTimer，傳入數值1表示設定每間隔1毫秒發出
Signal - timetout()，使用stop()方法的話可以停止目前的QTimer繼續發出Signal - timerout()：<br>


      </small>
      
      
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">if ( !timer.isActive() ) { </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; // ...start the timer (and so the progress) with a interval of 1 ms... </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; timer.start( 1 ); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; // ...and rename the start/pause/continue button to Pause </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; start-&gt;setText( "&amp;Pause" ); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">} else { // if the prgress is running... </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; // ...stop the timer (and so the prgress)... </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp; timer.stop(); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; // ...and rename the start/pause/continue button to Continue </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; start-&gt;setText( "&amp;Continue" ); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">} </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <br style="font-weight: bold;">


      </div>


      <small>QProgressBar的reset()方法會重置它的進度至未開始的狀態：</small><br>


      
      
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">// reset the progressbar </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">progress-&gt;reset(); </span></small><br>


      </div>


      <small><br>


QProgressBar的totalSteps()可以取得所設定的總Step數，將之與目前的Step數相比，如果相等就表示
進度完成，此時作完一些設定動作後離開函式，否則就將目前的Step數加1，再使用setProgress()重新指定給QProgressBar：</small><br>


      
      
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">void ProgressBar::slotTimeout() </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">{ </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp; int p = progress-&gt;progress(); </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">#if 1 </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp; // If the progress is complete... </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp; if ( p == progress-&gt;totalSteps() )&nbsp; { </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ...rename the start/pause/continue button to Start... </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; start-&gt;setText( "&amp;Start" ); </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ...and disable it... </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; start-&gt;setEnabled( FALSE ); </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ...and return </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return; </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp; } </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">#endif </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp; // If the process is not complete increase it </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp; progress-&gt;setProgress( ++p ); </small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">


      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">} </small><br>


      </div>


      <small><br>


在大部份的程式碼都解說過後，我們來看一下執行的畫面： <br>


      <img style="width: 308px; height: 151px;" alt="" src="images/QProgressBar-1.jpg"><br>


      </small><br>







      <small></small><span class="postbody"><br>







      </span> </td>








      <td style="width: 250px; text-align: center; vertical-align: top;">
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      
      
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
      <br>
      <br>
      
      
      
      
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      
      
      
      
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>





      <comment title=" adsense for content end" xmlns="http://disruptive-innovations.com/zoo/nvu"></comment><br>





      <comment title=" adsense for content" xmlns="http://disruptive-innovations.com/zoo/nvu"></comment>
      
      
      
      
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->&#160;</script>&nbsp;
      
      
      
      
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js"></script><comment title=" adsense for content end" xmlns="http://disruptive-innovations.com/zoo/nvu"></comment><br>





      <br>




      
      
      
      
      <center>
      
      
      
      
       <br>





      </center>





 </td>








    </tr>








  
  
  
  
  
  
  
  </tbody>
</table>








<br>







<span class="postbody"><br>








<br>








</span>
<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script>
</body>

<!-- Mirrored from openhome.cc/Gossip/Qt3Gossip/QProgressBar.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:22:53 GMT -->
</html>
