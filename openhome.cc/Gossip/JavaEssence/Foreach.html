<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/JavaEssence/Foreach.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:13:25 GMT -->
<head>




  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">

  <link rel="stylesheet" href="css/print.css" type="text/css">

  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>神奇的 foreach</title></head><body>

<h3><a href="../index.html">From
Gossip@Openhome</a></h3>

<h1><a href="index-2.html">Java Essence: 神奇的 foreach</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>

    <tr>

      <td style="width: 250px; text-align: center; vertical-align: top;"><script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->&#160;</script>&nbsp;
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js"></script><br>

      <br>
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>

      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->&#160;</script>&nbsp;
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js"></script><br>

      <br>

      <center>
       <br>

      </center>

      </td>

      <td style="vertical-align: top; width: 690px; text-align: left;"><small>如果你要走訪陣列中所有元素，通常你會這麼寫：<br></small><div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">public void go(int[] arr) {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; for(int i = 0; i &lt; arr.length; i++) {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(arr[i]);</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; }</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">}</span></small><br></div><small><br>事實上很多時候，從頭到尾走訪一個陣列（或Collection）中所有元素，是很常見的需求，上面的寫法並沒有錯，只不過索引資訊基本上是不需要的，硬要寫是很冗長的事。<br><br>在J2SE 5.0之後，引進了foreach新語法，上例你可以這麼改寫：<br></small><div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">public void go(int[] arr) {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; for(int element : arr) {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(element);</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; }</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">}</span></small><br></div><small><br>這個語法其實不僅限於陣列，還可以用在List、Set等。例如若是List實作物件，可以這麼寫：<br></small><div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">public void go(List&lt;String&gt; list) {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; for(String element : list) {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(element);</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; }</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">}</span></small><br><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;"></span></small></div><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;"><br></span></small><small style="font-family: Courier New,Courier,monospace;">如果<span style="font-family: Times New Roman,Times,serif;">是Set</span>也是可以的，例如：<span style="font-weight: bold;"></span></small><br><div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;"></span></small><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">public void go(Set&lt;String&gt; set) {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; for(String element : set) {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(element);</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; }</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">}</span></small><br></div><small><br>事實上，只要是Collection介面的實作物件，都可以用foreach語法：<br></small><div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">public void go(Collection&lt;String&gt; collection) {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; for(String element : collection) {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(element);</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; }</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">}</span></small><br></div><small><br>Java的foreach語法，其實是編譯器給的語法蜜糖。如果foreach要走訪的是陣列，事實上，編譯器會自動展開為以下的程式碼：<br style="font-weight: bold; font-family: Courier New,Courier,monospace;"></small><div style="margin-left: 40px;"><small><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">public void go(int ai[]) {<br>
&nbsp;&nbsp;&nbsp; int ai1[] = ai;<br>
&nbsp;&nbsp;&nbsp; int i = ai1.length;<br>
&nbsp;&nbsp;&nbsp; for(int j = 0; j &lt; i; j++) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int k = ai1[j];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(k);<br>
&nbsp;&nbsp;&nbsp; }<br>
}</span></small><small><span style="font-weight: bold; font-family: Courier New,Courier,monospace;"></span></small><br></div><small><br>若foreach運用在Collection的實作物件上，其實編譯器會展開為：<br></small><div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">public void go(Collection collection) {</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;"><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp; String s;</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;"><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;for(Iterator iterator = collection.iterator(); <br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;iterator.hasNext(); System.out.println(s))</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;"><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s = (String)iterator.next();</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;"><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">}</small><br></div><small><br>無論是Collection、List或Set，展開後皆利用iterator()方法傳回Iterator物件，並利用Iterator來移動、傳回下一個物件，這是 </small><small><a href="../DesignPattern/IteratorPattern.htm">Iterator
模式 </a>的實現。<br><br><span style="font-weight: bold;">在J2SE
1.4之前，Collection介面上直接定義了iterator()方法必須實作，因此所有Collection實作物件，皆需實作iterator
()。在J2SE
5.0之後，引進了Iterable介面，在介面中定義了iterator()方法，該方法必須傳回Iterator物件，而Collection介面繼
承了Iterable介面，</span></small><small style="font-weight: bold;">因此所有Collection實作物件，皆需實作iterator()，</small><small style="font-weight: bold;">因此所有Collection實作物件，都可以搭配使用foreach語法。</small><br><small><br><span style="font-weight: bold;">然而並非只有Collection介面的實作物件，才可以搭配foreach語法，事實上，由於Iterable介面的引進，使得只要是實作Iterable介面的物件，皆可搭配foreach語法來使用。</span>例如：<br>
</small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">public void go(Iterable&lt;String&gt; iterable) {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; for(String element : iterable) {</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(element);</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp; &nbsp; }</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">}</span></small><br>
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;"></span></small></div>
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;"><br>
      </span>不管你是List、Set還是Collection，只要是Iterable的物件，都可以用這個go，或是直接用</small>foreach<small style="font-family: Courier New,Courier,monospace;">語法，像是：<span style="font-weight: bold;"><br>
      </span></small><ul><li>Some.java</li></ul><pre>import java.util.Iterator;<br><br>public class IterableString <span style="font-weight: bold;">implements Iterable&lt;Character&gt;</span> {<br>    private String original;<br><br>    public IterableString(String original) {<br>        this.original = original;<br>    }<br><br>    public Iterator&lt;Character&gt; iterator() {<br>        return <span style="font-weight: bold;">new InnerIterator()</span>;<br>    }<br>	<br>    <span style="font-weight: bold;">private class InnerIterator implements Iterator&lt;Character&gt; {</span><br style="font-weight: bold;">        <span style="font-weight: bold;">private int index;</span><br style="font-weight: bold;">        <span style="font-weight: bold;">public boolean hasNext() {</span><br style="font-weight: bold;">            <span style="font-weight: bold;">return index &lt; original.length();</span><br style="font-weight: bold;">        <span style="font-weight: bold;">}</span><br style="font-weight: bold;"><br style="font-weight: bold;">        <span style="font-weight: bold;">public Character next() {</span><br style="font-weight: bold;">            <span style="font-weight: bold;">Character c = original.charAt(index);</span><br style="font-weight: bold;">            <span style="font-weight: bold;">index++;</span><br style="font-weight: bold;">            <span style="font-weight: bold;">return c;</span><br style="font-weight: bold;">        <span style="font-weight: bold;">}</span><br style="font-weight: bold;"><br style="font-weight: bold;">        <span style="font-weight: bold;">public void remove() {</span><span style="font-weight: bold;"></span><span style="font-weight: bold;">}</span><br style="font-weight: bold;">    <span style="font-weight: bold;">}</span><br style="font-weight: bold;">}</pre><small><br>IterableString類別實作了Iterable介面，因此你可以像以下這麼搭配foreach：<br></small><ul><li>Main.java</li></ul><pre>public class Main {<br>    public static void main(String[] args) {<br>        IterableString str = new IterableString("Justin");<br>    	for(Character c : str) {<br>            System.out.println(c);<br>        }<br>    }<br>}</pre><small><br>若你反組譯程式，會發現編譯器作了這些事：<br></small><div style="margin-left: 40px;"><small style="font-weight: bold; font-family: Courier New,Courier,monospace;">Character c;<br>
for(Iterator iterator = str.iterator(); iterator.hasNext();<br>
&nbsp; System.out.println(c))<br>
&nbsp;&nbsp;&nbsp; c = (Character)iterator.next();</small><small style="font-weight: bold; font-family: Courier New,Courier,monospace;"></small><br></div><small><br>
在JDK7之後，有不多API都實作了Iterable，例如NIO2的Path物件等。<br>
<br></small></td>

    </tr>

  </tbody>
</table>

<br>

<br>

<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script>
</body>
<!-- Mirrored from openhome.cc/Gossip/JavaEssence/Foreach.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:13:25 GMT -->
</html>