<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/JavaEssence/SourceTarget.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:12:01 GMT -->
<head>


  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">

  <link rel="stylesheet" href="css/print.css" type="text/css">

  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>降級你的類別檔案</title></head><body>

<h3><a href="../index.html">From
Gossip@Openhome</a></h3>

<h1><a href="index-2.html">Java Essence: 降級你的類別檔案</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>

    <tr>

      <td style="width: 250px; text-align: center; vertical-align: top;"><script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->&#160;</script>&nbsp;
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js"></script><br>

      <br>

      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>

      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->&#160;</script>&nbsp;
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js"></script><br>

      <br>

      <center>
       <br>

      </center>

      </td>

      <td style="vertical-align: top; width: 690px; text-align: left;"><small>如果你在新版本的JDK上開發程式，編譯過後的.class檔案，在舊版本的JRE上執行，將會發生以下的錯誤訊息：<br><img style="width: 669px; height: 433px;" alt="" src="images/SourceTarget-1.jpg"><br><br>上面的執行範例中，是在JDK6下編譯出.class，切換PATH至JDK1.4，使用其JRE1.4來載入、執行.class，結果出現<span style="font-weight: bold;">UnsupportedClassVersionError</span>，並指出這個.class的major.minor為50.0。<br><br><span style="font-weight: bold;">編譯器對於每個.class檔案，都會標示主版本號與次版本號，不同的版本號，意味著這個類別檔案是不同版本的JDK編譯出來，而.class的格式可能有所不同。JVM在載入.class前，會先確認其版本號是否在可接受的範圍，否則就不會處理該.class檔案。</span><br><br></small><small>class的基本結構如下：<br><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; ClassFile {</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; u4 magic;</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; u2 minor_version;</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; u2 major_version;</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; u2 constant_pool_count;</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cp_info constant_pool[constant_pool_count-1];</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; u2 access_flags;</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; u2 this_class;</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; u2 super_class;</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; u2 interfaces_count;</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; u2 interfaces[interfaces_count];</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; u2 fields_count;</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; field_info fields[fields_count];</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; u2 methods_count;</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; method_info methods[methods_count];</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; u2 attributes_count;</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; attribute_info attributes[attributes_count];</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; }</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;"><br>.class的第1到4位元組是標示類別檔案身份的魔術數字（Magic Number），它的值是<span style="font-weight: bold;">0xCAFEBABE（咖啡寶貝）</span>。<span style="font-weight: bold;">第5到6位元組是minor版本號，第7到第8位元組為major版本號</span>，可以使用十六進位編輯器觀看編好的.class檔案看到：<br><img style="width: 691px; height: 247px;" alt="" src="images/SourceTarget-2.jpg"><br><br>其中00 32轉換為十進位制，就是50，這也就是為什麼剛剛顯示的錯誤訊息中，指出major.minor為50.0。你也可以使用JDK工具程式javap，確認.class的版本號：<br><img style="width: 657px; height: 179px;" alt="" src="images/SourceTarget-3.jpg"><br><br></small><small>在 <a href="http://java.sun.com/docs/books/jvms/second_edition/html/VMSpecTOC.doc.html">The Java<sup>TM</sup> Virtual Machine Specification</a> 中 <a href="http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html">The class File Format</a> 最底下的註釋1中指出，<span style="font-weight: bold;">Sun
JDK
1.0.2的JVM實作，支援的.class檔案版本號為45.0到45.3。1.1.X則支援45.0到45.65535（向前相容）。1.2則支援
45.0到46.0。在程式中，可以透過System.getProperty("java.class.version")取得JRE所支援的類別版本
號.，使用System.getProperty("java.runtime.version")取得JRE版本訊息。</span><br><br>在編譯的時候，可以使用-target指定編譯出來的.class，必須符合所指定平台所允許的版本號，例如：<br><img style="width: 657px; height: 219px;" alt="" src="images/SourceTarget-4.jpg"><br><br>上面這個例子指定了編譯出來的.class必須是1.5平台所接受的版本號（49.0）。<span style="font-weight: bold;">編譯器會有預設的target值</span>，例如在JDK6預設的target就是1.6。在javac時，還可以指定<span style="font-weight: bold;">-source</span>，<span style="font-weight: bold;">-target必須大於-source</span>，</small><small>JDK5與JDK6沒什麼語法的大改變，<span style="font-weight: bold;">預設的語法版本</span>是1.5，所以上例中，只需要指定-target為1.5即可，</small><small>但<span style="font-weight: bold;">JDK1.4到JDK5之間的語法改變很大，要在JDK5或JDK6中，編譯.class檔案為1.4平台可接受的版本，還要指定-source引數為1.4</span>，編譯器會檢查是否使用到1.4以外的語法，沒有的話再編譯類別檔案。例如：<br><img style="width: 657px; height: 239px;" alt="" src="images/SourceTarget-5.jpg"><br><br>事實上，並非得切換PATH至較低版本的JDK或JRE，才能測試具較低版本號的類別檔案，<span style="font-weight: bold;">可以在執行時使用-version引數並指定版本</span>，例如：<br><img style="width: 687px; height: 639px;" alt="" src="images/SourceTarget-6.jpg"><br><br>
&nbsp;如果使用-version指定的版本，實際上無法在系統上找到已安裝的JRE，則會出現Unable to locate JRE meeting specification的錯誤。<br>
<br>如果使用IDE，其都會有選項設定，讓你指定目標平台，例如Eclipse中設定的畫面：<br><img style="width: 698px; height: 475px;" alt="" src="images/SourceTarget-7.jpg"><br><br><br></small></td>

    </tr>

  </tbody>
</table>

<br>

<br>

<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script>
</body>
<!-- Mirrored from openhome.cc/Gossip/JavaEssence/SourceTarget.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:12:22 GMT -->
</html>