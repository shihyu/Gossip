<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/JUnit/ITable.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:19:39 GMT -->
<head>














  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">







  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/print.css" type="text/css">







  
  
  
  
  
  
  
  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>資料表建立與處理</title></head><body>







<h3><a href="../index.html">From
Gossip@Openhome</a></h3>







<h1><a href="index-2.html">JUnit Gossip: 資料表建立與處理<br>
</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>

    <tr>

      <td style="vertical-align: top; width: 250px; text-align: center;">
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>

      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br><center><script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
</script>
<script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</center></td>

      <td style="vertical-align: top; width: 690px; text-align: left;"><small>一旦你取得一個<span style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">IDataSet</span>，就可以使用<span style="font-weight: bold;">getTable()</span>指定表格名稱來取得對應的<span style="font-weight: bold;">ITable</span>物件，你可以從ITable</span>物件上取得各欄位資料，就如<big> </big></small><small><big><a href="DbUnit.html"><small>使用 DbUnit</small></a> </big>中的片段：<br>
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; ...</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 取得表格資料</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: red;">ITable table = dataSet.getTable("T_BOOKMARK");</span></span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;Bookmark&gt; expected = new ArrayList&lt;Bookmark&gt;();</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 表格中的列（row）數</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: red;">int rows = table.getRowCount();</span></span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(int i = 0; i &lt; rows; i++) {</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 取得每列的各個欄位</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: red;">String url = (String) table.getValue(i, "url");</span></span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String title = (String) table.getValue(i, "title");</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String category = (String) table.getValue(i, "category");</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; expected.add(new Bookmark(url, title, category));</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; ...</span></small><br>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">如果想得知IDataSet中所有表格名稱，則可以呼叫<span style="font-weight: bold;">getTableNames()</span>傳回字串陣列，藉以再搭配getTable()來取得ITable物件。<br>
      <br>
如果你已經有一個<span style="font-weight: bold;">IDatabaseConnection</span>物件，可以直接呼叫<span style="font-weight: bold;">createTable()</span>，從指定的資料表中建立ITable物件，無需再透過IDataSet的getTable()方法。例如：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">ITable table = dbConn.createTable("T_BOOKMARK");</span></small><br>
      </div>
      <br>
      <small>上例其實相當於：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">ITable table = dbConn.createQueryTable("T_BOOKMARK", "SELECT * FROM T_BOOKMARK");</span></small><br>
      </div>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">如果你已經有一個PreparedStatement，也可以透過<span style="font-weight: bold;">createTable()</span>的另一個版本來建立ITable：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">ITable table = dbConn.createTable("T_BOOKMARK", pstmt);</span></small><br>
      </div>
      <br>
      <small>DbUnit的<span style="font-family: Courier New,Courier,monospace; font-weight: bold;">Assertion</span>類別中，<span style="font-family: Courier New,Courier,monospace; font-weight: bold;">assertEquals()</span>可以針對<span style="font-family: Courier New,Courier,monospace;">ITable</span>進行斷言，如果想忽略某個欄位，也可以使用<span style="font-family: Courier New,Courier,monospace; font-weight: bold;">assertEqualsIgnoreCols()</span>方法直接傳入<span style="font-family: Courier New,Courier,monospace;">IDataSet</span>。例如 的片段：<br>
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; ...<br>
&nbsp;&nbsp;&nbsp; @Test<br>
&nbsp;&nbsp;&nbsp; public void testAdd() throws Exception {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 用待測的DAO安插資料<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bookmark bookmark = new Bookmark("http://m", "n", "o");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dao.add(bookmark);<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 用 DbUnit 取得資料<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IDataSet dataSet = dbConn.createDataSet();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 讀取預期資料集合<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IDataSet expected = getXMLDataSet("expected.xml");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 斷言資料集合相等性，但忽略id欄位<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; assertEqualsIgnoreCols(expected, dataSet, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "T_BOOKMARK", new String[] {"id"});<br>
&nbsp;&nbsp;&nbsp; }</span><span style="font-weight: bold; font-family: Courier New,Courier,monospace;"></span><br>
      </small><small><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; ...</span></small><br>
      <small><br>
      <span style="font-family: Courier New,Courier,monospace;">或者你也可以使用<span style="font-weight: bold;">IColumnFilter</span>的實作物件來直接過濾ITable物件。例如上例可以改寫為：<br>
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; ...</span><br style="font-weight: bold;">
      <span style="font-weight: bold; color: red;">&nbsp;&nbsp;&nbsp; private ITable getIdIgnoredTable(IDataSet dataSet) throws Exception {</span><br style="font-weight: bold; color: red;">
      <span style="font-weight: bold; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return DefaultColumnFilter.includedColumnsTable(</span><br style="font-weight: bold; color: red;">
      <span style="font-weight: bold; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dataSet.getTable("t_bookmark"), </span><br style="font-weight: bold; color: red;">
      <span style="font-weight: bold; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
new String[] {"url", "title", "category"});</span><br style="font-weight: bold; color: red;">
      <span style="font-weight: bold; color: red;">&nbsp;&nbsp;&nbsp; }</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; </span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; @Test</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public void testAdd() throws Exception {</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 用待測的DAO安插資料</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bookmark bookmark = new Bookmark("http://m", "n", "o");</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dao.add(bookmark);</span><br style="font-weight: bold;">
      <br style="font-weight: bold;">
      <span style="font-weight: bold; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ITable result =
getIdIgnoredTable(dbConn.createDataSet());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      </span><br style="font-weight: bold; color: red;">
      <span style="font-weight: bold; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ITable expected = getIdIgnoredTable(getXMLDataSet("expected.xml"));</span><br style="font-weight: bold; color: red;">
      <span style="font-weight: bold; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Assertion.assertEquals(expected, result);</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; }</span><br style="font-weight: bold;">
      </span></small><small style="font-weight: bold;"><span style="font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; ...</span></small><br>
      <small><span style="font-family: Courier New,Courier,monospace;"></span><br>
      <span style="font-family: Courier New,Courier,monospace;">如果你想要ITable的結果是排序過後的結果，在呼叫IDatabaseConnection</span>的</small><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">createQueryTable()</span>時，可以指定"ORDER BY"語句，或者你可以使用SortedTable類別來對ITable進行裝飾。例如：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">String[] orderBy = </span></small><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">{"column1", "column2"};</small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">Assertion.assertEquals(</small><br>
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new SortedTable(expected, </small><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">orderBy</small><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">), new SortedTable(actual, </small><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">orderBy</small><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">));</span></small><br>
      </div>
      <br style="font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;">SortedTable預設會使用欄位的toString()字串結果來排序，如果你想要使用Comparable介面定義的方式來排序，可以設定SortedTable的<span style="font-weight: bold;">setUseComparable()</span>方法。例如：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">String[] orderBy = </span></small><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">{"COLUMN1"};</small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">SortedTable sortedTable1 = new SortedTable(table1, orderBy);</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; color: red;"><span style="font-weight: bold;">sortedTable1.setUseComparable(true); </span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">SortedTable sortedTable2 = new SortedTable(table2, orderBy);</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; color: red;"><span style="font-weight: bold;">sortedTable2.setUseComparable(true);</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">Assertion.assertEquals(sortedTable1, sortedTable2);</span></small><br>
      </div>
      <small style="font-family: Courier New,Courier,monospace;"><br>
對於IDataSet，也有個<span style="font-weight: bold;">SortedDataSet</span>裝飾類別，可以傳回排序後的SortedTable。<br>
      <br>
無論是IDataSet或ITable，Assertion的assertEquals()都有一個接受第三個參數為<span style="font-weight: bold;">FailureHandler</span>的版本，一旦指定了這個版本，斷言失敗時並不會引發錯誤，而會由</small><small style="font-family: Courier New,Courier,monospace;">FailureHandler加以收集不一致的情況，以便你檢視差異結果。例如：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">DiffCollectingFailureHandler diffHandler = new DiffCollectingFailureHandler();</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">Assertion.assertEquals(expected, dataSet, diffHandler);</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">for(Object o : diffHandler.getDiffList()) {</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; Difference diff&nbsp; = (Difference) o;</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; Object actualValue = diff.getActualValue();</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; ...</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">}</span></small><br style="font-weight: bold;">
      </div>
      <br>
      <br>
<br>
</td>

    </tr>

  </tbody>
</table>

<br>
<br>

<br>

<br>







<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script></body>
<!-- Mirrored from openhome.cc/Gossip/JUnit/ITable.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:19:39 GMT -->
</html>