<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/JavaScript/This.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:16:22 GMT -->
<head>




















  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">







  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/print.css" type="text/css">







  
  
  
  
  
  
  
  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>this 是什麼？</title></head><body>







<h3><a href="../index.html">From
Gossip@Openhome</a></h3>







<h1><a href="index-2.html">JavaScript Essence: this 是什麼？<br>
</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>

    <tr>

      <td style="vertical-align: top; width: 250px; text-align: center;">
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>

      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br><center> <br>
</center></td>

      <td style="vertical-align: top; width: 690px; text-align: left;">
      <div style="text-align: right;"><a href="http://openhome.cc/eGossip/JavaScript/This.html">English</a><br style="font-family: Courier New,Courier,monospace;">



    

  


      </div>
      <small><br>
在JavaScript中，函式是物件，是<span style="font-family: Courier New,Courier,monospace;">Function</span>的實例，可以在變數間任意指定，可以傳給函式的參數參考，當然，要新增為物件的特性也是可以的。例如：</small><small><br></small>
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">







        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">js&gt; var p1 = { name : 'Justin', age&nbsp; : 35 };<br>
js&gt; var p2 = { name : 'momor', age&nbsp; : 32 };<br>
js&gt; function toString() {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return '[' + this.name + ',' + this.age + ']';<br>
&nbsp; &gt; }<br>
js&gt; p1.toString = toString;<br>
</span>function toString() {<br>
&nbsp;&nbsp;&nbsp; return "[" + this.name + "," + this.age + "]";<br>
}<span style="font-weight: bold;"><br>
            <br>
js&gt; p2.toString = toString;</span><br>
function toString() {<br>
&nbsp;&nbsp;&nbsp; return "[" + this.name + "," + this.age + "]";<br>
}<span style="font-weight: bold;"><br>
            <br>
js&gt; p1.toString();<br>
            </span>[Justin,35]<span style="font-weight: bold;"><br>
js&gt; p2.toString();<br>
            </span>[momor,32]<span style="font-weight: bold;"><br>
js&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      
      </table>


      <small><br>
      <span style="font-family: Courier New,Courier,monospace;">在上例中定義了一個toString()函式，並分別設定為p1與p2的toString來參考，透過p1呼叫時，toString()就像是p1的方法（</span>Method<span style="font-family: Courier New,Courier,monospace;">），透過p2呼叫時，toString()就像是p2的方法。</span><br></small><br>
      <small style="font-family: Courier New,Courier,monospace;">在上例中，toString()函式中使用了<span style="font-weight: bold;">this</span>，在呼叫函式時，每個函式都會有個this，然而this參考至哪個物件，其實依呼叫方式而有所不同。以上例而言，透過p1呼叫時，toString()中的this會參考至p1所參考的物件，也因此顯示p1物件的name與age值，</small><small style="font-family: Courier New,Courier,monospace;">透過p2呼叫時，toString()中的this則會參考至p2所參考的物件。<br>
      <br>
如果呼叫函式時是透過物件與點運算子的方式呼叫，則this會參考至點運算子左邊的物件。<br>
      <br>
在</small><small>JavaScript</small><small style="font-family: Courier New,Courier,monospace;">中，函式是Function的實例，<span style="font-weight: bold;">Function都會有個call()方法，可以讓你決定this的參考對象。</span>舉例來說，你可以如下呼叫：</small><small><br></small>
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">








        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">js&gt; var p1 = { name : 'Justin', age&nbsp; : 35 };<br>
js&gt; var p2 = { name : 'momor', age&nbsp; : 32 };<br>
js&gt; function toString() {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return '[' + this.name + ',' + this.age + ']';<br>
&nbsp; &gt; }<br>js&gt; toString.call(p1);<br>
</span>[Justin,35]<span style="font-weight: bold;"><br>
js&gt; toString.call(p2);<br>
            </span>[momor,32]<span style="font-weight: bold;"><br>
js&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      
      </table>



      <small><small><br>
      </small><span style="font-family: Courier New,Courier,monospace;">這次並沒有將toString指定為物件的特性，而是直接使用call()方法來呼叫函式，call()方法的第一個參數就是用來指定函式中的this所參考的物件。</span>如果函式原本具有參數，則可接續在第一個參數之後。例如：</small><small><br></small>
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">









        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">js&gt; function add(num1, num2) {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return this.num + num1 + num2;<br>
&nbsp; &gt; }<br>
js&gt; var o = { num : 10 };<br>
js&gt; add.call(o, 20, 30);<br>
</span>60<span style="font-weight: bold;"><br>
js&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      
      </table>




      <small style="font-family: Courier New,Courier,monospace;"><small><small><br>
</small></small>Function也有個<span style="font-weight: bold;">apply()</span>方法，作用與call()方法相同，也可讓你在第一個參數指定this所參考的對象，不過apply()方法指定後續引數時，必須將引數收集為一個陣列，如果你有一組引數，必須在多次呼叫時共用，就可以使用apply()方法。例如：</small><small><br></small>
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">










        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">js&gt; function add(num1, num2) {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return this.num + num1 + num2;<br>
&nbsp; &gt; }<br>
js&gt; var o1 = { num : 10 };<br>
js&gt; var o2 = { num : 100 };<br>
js&gt; var args = [20, 30];<br>
js&gt; add.apply(o1, args);<br>
</span>60<span style="font-weight: bold;"><br>
js&gt; add.apply(o2, args);<br>
            </span>150<span style="font-weight: bold;"><br>
js&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      
      </table>





      <small style="font-family: Courier New,Courier,monospace;"><small><small><small><br>
</small></small></small>所以，<span style="font-weight: bold;">this實際參考的對象，是以呼叫方式而定，而不是它是否附屬在哪個物件而定。</span>例如就算函式是附屬在函式上的某個特性，也可以這麼改變this所參考的對象：</small><small><br></small>
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">











        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">js&gt; var p1 = { name : 'Justin' };<br>
js&gt; var p2 = { name : 'momor' };<br>
js&gt; function toString() {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return this.name;<br>
&nbsp; &gt; }<br>
js&gt; p1.toString = toString;<br>
</span>function toString() {<br>
&nbsp;&nbsp;&nbsp; return this.name;<br>
}<br>
            <span style="font-weight: bold;"><br>
js&gt; p2.toString = toString;<br>
            </span>function toString() {<br>
&nbsp;&nbsp;&nbsp; return this.name;<br>
}<br>
            <span style="font-weight: bold;"><br>
js&gt; p1.toString();<br>
            </span>Justin<span style="font-weight: bold;"><br>
js&gt; p2.toString();<br>
            </span>momor<span style="font-weight: bold;"><br>
js&gt; p1.toString.call(p2);<br>
            </span>momor<span style="font-weight: bold;"><br>
js&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      
      </table>






      <small><small style="font-family: Courier New,Courier,monospace;"><small><small><small><br>
</small></small></small></small><span style="font-family: Courier New,Courier,monospace;">在最後一個測試中，是以p1.toString.call(p2)的呼叫方式，所以雖然toString()是p1的特性，但call()指定this是參考至p2，結果當然也是傳回p2的name。</span></small><br>
      <br>
      <small>在用物件實字建立物件時，也可以直接指定函式作為特性。例如：</small><small><br></small>
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">











        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">js&gt; var o = {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; name : 'Justin',<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; toString : function() {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.name;<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp; &gt; };<br>
js&gt; o.toString();<br>
</span>Justin<span style="font-weight: bold;"><br>
js&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      
      </table>






      <small><small style="font-family: Courier New,Courier,monospace;"><small><small><small><br>
</small></small></small></small><span style="font-family: Courier New,Courier,monospace;">由於頂層函式是全域物件上的特性，所以</span></small><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">作為一個頂層函式呼叫時，this會參考至全域</span>。例如：</small><small><br></small>
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">












        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">js&gt; function func() {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return this;<br>
&nbsp; &gt; }<br>
js&gt; func() == this;<br>
</span>true<span style="font-weight: bold;"><br>
js&gt; this.func() == this;<br>
            </span>true<span style="font-weight: bold;"><br>
js&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      
      </table>







      <small><small><small style="font-family: Courier New,Courier,monospace;"><small><small><small><br>
</small></small></small></small></small><span style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">當一個內部函式直接被呼叫時，this也是參考至全域物件</span>。例如：</span></small><small><br></small>
      
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">













        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">js&gt; function func() {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; function inner() {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this;<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return inner();<br>
&nbsp; &gt; }<br>
js&gt; func() == this;<br>
</span>true<span style="font-weight: bold;"><br>
js&gt; var o1 = { func : func };<br>
js&gt; o1.func() == o1;<br>
            </span>false<span style="font-weight: bold;"><br>
js&gt; o1.func() == this;<br>
            </span>true<br>
            <span style="font-weight: bold;">js&gt; func.call(o1) == this;</span><br>
true<br>
            <span style="font-weight: bold;">js&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      
      </table>








      <small><small><small><small style="font-family: Courier New,Courier,monospace;"><small><small><small><br>
</small></small></small></small></small></small>在上例中，<span style="font-family: Courier New,Courier,monospace;">最後一個例子雖然指定外部函式的this為o1，但事實上，</span></small><small style="font-family: Courier New,Courier,monospace;">內部函式被呼叫時，this仍是參考至全域物件。如果是以下這個例子：<br>
      </small>
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">
<tbody><tr><td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">js&gt; function func() {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; function inner() {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this;<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; this.inner = inner;<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return this.inner();<br>
&nbsp; &gt; }<br>
js&gt; func() == this;<br>
</span>true<span style="font-weight: bold;"><br>
js&gt; var o1 = { func : func };<br>
js&gt; o1.func() == o1;<br>
            </span>true<span style="font-weight: bold;"><br>
js&gt; o1.func.call(this) == this;<br>
            </span>true<span style="font-weight: bold;"><br>
js&gt; o1.func.call(o1) == o1;<br>
            </span>true<span style="font-weight: bold;"><br>
js&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      </table>
      <br>
      <small>在JavaScript執行過程中，<span style="font-family: Courier New,Courier,monospace;">搞清楚this是誰有時非常重要，<span style="font-weight: bold;">this的決定方式是在於呼叫，而非定義的方式</span>。</span></small><br>
      <br>
      <small>舉個例子來說，如果你想要自行實現<span style="font-family: Courier New,Courier,monospace;">Array的forEach</span>方法，則可以如下：</small><small style="font-family: Courier New,Courier,monospace;"><br>
      </small>
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">

<tbody><tr><td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">js&gt; var obj = {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; '0' : 100,<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; '1' : 200,<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; '2' : 300,<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; length : 3,<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; forEach : function(callback) {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(var i = 0; i &lt; this.length; i++) {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(this[i]);<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp; &gt; };<br>
js&gt; obj.forEach(function(element) {<br>
&nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; print(element);<br>
&nbsp; &gt; });<br>
</span>100<br>
200<br>
300<span style="font-weight: bold;"><br>
js&gt;</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      </table>

      <br style="font-family: Courier New,Courier,monospace;">

      <small style="font-family: Courier New,Courier,monospace;">在上例中，由於呼叫forEach時，obj參考的物件就是this所參考的物件，因而可以取得length等特性，函式是物件，所以自然可以丟給forEach作為引數，這也就是 </small><small style="font-family: Courier New,Courier,monospace;"><big><a href="Array.html"><small>陣列</small></a></big> 中介紹到Array上forEach方法的實作原理。</small><br>
<br style="font-family: Courier New,Courier,monospace;">

      <br>
</td></tr></tbody></table><br>
<br>

<br>

<br>







<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script></body>
<!-- Mirrored from openhome.cc/Gossip/JavaScript/This.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:16:22 GMT -->
</html>