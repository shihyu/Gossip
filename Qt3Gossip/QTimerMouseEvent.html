<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<!-- Mirrored from openhome.cc/Gossip/Qt3Gossip/QTimerMouseEvent.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:22:38 GMT -->
<head>









  
  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">









  
  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/print.css" type="text/css">









  
  
  
  
  
  
  
  
  <meta content="text/html; charset=Big5" http-equiv="content-type">








  
  
  
  
  
  
  
  
  <title>再看 QTimer - 結合滑鼠事件顯示日期</title>
</head>


<body>









<h3><a href="../index.html">From
Gossip@Openhome</a></h3>









<h1><a href="index.html">Qt3 Gossip: 再看 QTimer - 結合滑鼠事件顯示日期</a></h1>









<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">









  <tbody>









    <tr>









      <td style="width: 676px; vertical-align: top;"> <small>這個範例是Qt安裝好之後所提供的實例，上一個範例就是改寫自這個例子，在這個例子中，可以學習到更多有關於事件的處理。 <br>



      <br>



首先編輯dclock.h： <br>



      </small>
      
      
      
      <ul>



        <li>dclock.h</li>



      
      
      
      </ul>



      
      
      
      <pre>#ifndef DCLOCK_H<br>#define DCLOCK_H<br><br>#include &lt;qlcdnumber.h&gt;<br><br><br>class DigitalClock : public QLCDNumber          // digital clock widget<br>{<br>    Q_OBJECT<br>public:<br>    DigitalClock( QWidget *parent=0, const char *name=0 );<br><br>protected:                                      // event handlers<br>    void        timerEvent( QTimerEvent * );<br>    void        mousePressEvent( QMouseEvent * );<br><br>private slots:                                  // internal slots<br>    void        stopDate();<br>    void        showTime();<br><br>private:                                        // internal data<br>    void        showDate();<br><br>    bool        showingColon;<br>    int         normalTimer;<br>    int         showDateTimer;<br>};<br><br><br>#endif // DCLOCK_H<br></pre>




      <span class="postbody"></span><br>



      <small>再來編輯dclock.cpp： <br>



      </small>
      
      
      <ul>


        <li>dclock.cpp</li>


      
      
      </ul>


      
      
      <pre>#include "dclock.h"<br>#include &lt;qdatetime.h&gt;<br><br><br>//<br>// Constructs a DigitalClock widget with a parent and a name.<br>//<br><br>DigitalClock::DigitalClock( QWidget *parent, const char *name )<br>    : QLCDNumber( parent, name )<br>{<br>    showingColon = FALSE;<br>    setFrameStyle( QFrame::Panel | QFrame::Raised );<br>    setLineWidth( 2 );            // set frame line width<br>    showTime();               // display the current time<br>    normalTimer = startTimer( 500 );      // 1/2 second timer events<br>    showDateTimer = -1;            // not showing date<br>}<br><br><br>//<br>// Handles timer events for the digital clock widget.<br>// There are two different timers; one timer for updating the clock<br>// and another one for switching back from date mode to time mode.<br>//<br><br>void DigitalClock::timerEvent( QTimerEvent *e )<br>{<br>    if ( e-&gt;timerId() == showDateTimer )   // stop showing date<br>        stopDate();<br>    else {               // normal timer<br>        if ( showDateTimer == -1 )      // not showing date<br>            showTime();<br>    }<br>}<br><br>//<br>// Enters date mode when the left mouse button is pressed.<br>//<br><br>void DigitalClock::mousePressEvent( QMouseEvent *e )<br>{<br>    if ( e-&gt;button() == QMouseEvent::LeftButton )      // left button pressed<br>        showDate();<br>}<br><br><br>//<br>// Shows the current date in the internal lcd widget.<br>// Fires a timer to stop showing the date.<br>//<br><br>void DigitalClock::showDate()<br>{<br>    if ( showDateTimer != -1 )         // already showing date<br>        return;<br>    QDate date = QDate::currentDate();<br>    QString s;<br>    s.sprintf( "%2d %2d", date.month(), date.day() );<br>    display( s );            // sets the LCD number/text<br>    showDateTimer = startTimer( 2000 );      // keep this state for 2 secs<br>}<br><br>//<br>// Stops showing the date.<br>//<br><br>void DigitalClock::stopDate()<br>{<br>    killTimer( showDateTimer );<br>    showDateTimer = -1;<br>    showTime();<br>}<br><br>//<br>// Shows the current time in the internal lcd widget.<br>//<br><br>void DigitalClock::showTime()<br>{<br>    showingColon = !showingColon;      // toggle/blink colon<br>    QString s = QTime::currentTime().toString().left(5);<br>    if ( !showingColon )<br>        s[2] = ' ';<br>    if ( s[0] == '0' )<br>        s[0] = ' ';<br>    display( s );            // set LCD number/text<br>}<br></pre>


      <small><br>



再來是主函式main.cpp： <br>


      </small>
      
      
      <ul>


        <li>main.cpp</li>


      
      
      </ul>


      
      
      <pre>#include "dclock.h"<br>#include &lt;qapplication.h&gt;<br><br>int main( int argc, char **argv )<br>{<br>    QApplication a( argc, argv );<br>    DigitalClock *clock = new DigitalClock;<br>    clock-&gt;resize( 170, 80 );<br>    a.setMainWidget( clock );<br>    clock-&gt;setCaption("Qt Example - Digital Clock");<br>    clock-&gt;show();<br>    return a.exec();<br>}<br></pre>


      <small><br>


      </small><small><br>



這個範例的大部份程式碼與我們上一個範例相同，從原文註解中您應可以稍微瞭解每一行的作用，我們解說重要的部份。</small><small>
啟動QTimer，並設定每秒鐘發出QTimerEvent事件，startTimer()會傳回一個整數表示這個設定的timerId，我們可以藉由這
個timerId得知是哪個時間間隔放出的事件，不過就這個程式而言，normalTimer是沒有使用到的；showDateTimer也是用來接收
timerId，指示QLCDNumber要顯示日期或時間，-1時表示不顯示，這在之後會用到：<br>



      </small><small> 
      </small>
      
      
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">normalTimer = startTimer( 500 );&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 1/2 second timer events </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
showDateTimer = -1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // not showing date </span></small><br style="font-weight: bold;">


      </div>


      <small>
      <br>



      </small><small>
如果滑鼠在視窗上按下，就會發生滑鼠事件QMouseEvent，接收此事件的mousePressEvent函式會被執行，我們使用button()取得按下的是滑鼠左鍵或是右鍵，如果是左鍵，就執行showData()來顯示日期：</small><br style="font-weight: bold;">


      
      
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
void DigitalClock::mousePressEvent( QMouseEvent *e ) </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
{ </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; if ( e-&gt;button() == QMouseEvent::LeftButton )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // left button pressed </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showDate(); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
} </span></small><br>


      </div>


      <small>
      <br>


      </small><small>
是否顯示日期的函式，如果showDateTimer不等於-1，表示目前正在顯示日期，所以就直接跳出程式，不作處理；如果showDateTimer
等於-1，則要顯示日期，我們使用QDate::currentDate()取得系統目前的日期，這次我們使用QString的sprintf()方法設
定日期格式，分別使用month()與day()取得日期的月與日，sprintf()的設定方式與C語言的printf()是類似
的，使用格式限定字%d來指定格式，%2d表示每個整數用兩個定位點來顯示：</small><br style="font-weight: bold;">


      
      
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
void DigitalClock::showDate() </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
{ </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; if ( showDateTimer != -1 )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // already showing date </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return; </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; QDate date = QDate::currentDate(); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; QString s; </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; s.sprintf( "%2d %2d", date.month(), date.day() ); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; display( s );&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // sets the LCD number/text </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; showDateTimer = startTimer( 2000 );&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // keep this state for 2 secs </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
} </span></small><br>


      </div>


      <small>
      <br>



我們的日期顯示使用startTimer(2000)設定為顯示2000毫秒（2秒），並取得timerId儲存於showDateTimer中。 <br>



      <br>


      </small><small>
由於這個程式會啟動兩個QTimer，當我們接收到QTimerEvent事件時，我們必須判斷是哪一個QTimer所發出的，我們可以使用e-&gt;
timerId()來取得事件的timerId，再與之前我們所取得的timerId比較，像在這例中，如果取得的timerId等於
showDateTimer所儲存的，表示2000毫秒的間隔到了，這表示該從日期顯示轉回時間顯示，我們呼叫stopDate()進行這項處理：</small><br style="font-weight: bold;">


      
      
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
void DigitalClock::timerEvent( QTimerEvent *e ) </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
{ </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; if ( e-&gt;timerId() == showDateTimer )&nbsp;&nbsp; // stop showing date </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stopDate(); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; else {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // normal timer </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp; if ( showDateTimer == -1 )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // not showing date </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showTime(); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; } </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
} </span></small><br>


      </div>


      <small>
      <br>


      </small><small>
這是停止日期顯示的處理函式，killTimer()會刪除指定的timerId的QTimer，而我們再度將showDateTimer設定為-1，並重;新顯示系統時間：</small><br>


      
      
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
void DigitalClock::stopDate() </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
{ </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; killTimer( showDateTimer ); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; showDateTimer = -1; </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
&nbsp;&nbsp;&nbsp; showTime(); </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">


      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">
} </span></small><br>


      </div>


      <small>
      <br>



      這個程式的執行結果有兩個狀態，一個是顯示系統時間，當按下滑鼠時就顯示系統日期，過了2秒後會自動跳回時間顯示，以下是時間顯示： <br>


      <img style="width: 200px; height: 115px;" alt="" src="images/QTimerMouseEvent-1.jpg"><br>


      <br>



      </small><span class="postbody"><small>以下是日期顯示：<br>


      <img style="width: 200px; height: 115px;" alt="" src="images/QTimerMouseEvent-2.jpg"><br>


      </small><br>


      <br>








      </span> </td>









      <td style="width: 250px; text-align: center; vertical-align: top;">
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      
      
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
      <br>
      <br>
      
      
      
      
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      
      
      
      
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>





      <comment title=" adsense for content end" xmlns="http://disruptive-innovations.com/zoo/nvu"></comment><br>





      <comment title=" adsense for content" xmlns="http://disruptive-innovations.com/zoo/nvu"></comment>
      
      
      
      
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->&#160;</script>&nbsp;
      
      
      
      
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js"></script><comment title=" adsense for content end" xmlns="http://disruptive-innovations.com/zoo/nvu"></comment><br>





      <br>




      
      
      
      
      <center>
      
      
      
      
       <br>





      </center>





 </td>









    </tr>









  
  
  
  
  
  
  
  
  </tbody>
</table>









<br>








<span class="postbody"><br>









<br>









</span>
<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script>
</body>

<!-- Mirrored from openhome.cc/Gossip/Qt3Gossip/QTimerMouseEvent.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:22:41 GMT -->
</html>
