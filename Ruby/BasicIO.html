<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/Ruby/BasicIO.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:15:42 GMT -->
<head>










  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">

  
  <link rel="stylesheet" href="css/print.css" type="text/css">

  
  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>基本輸入輸出</title></head><body>
<h3><a href="../index.html">From
Gossip@Openhome</a></h3>

<h1><a href="index-2.html">Ruby Gossip: 基本輸入輸出<br>
</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>
    <tr>
      <td style="vertical-align: top; width: 250px; text-align: center;"><script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>
      <br>
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>
      <br>
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>
      <br>
      <center>
       </center>
      </td>
      <td style="vertical-align: top; width: 690px; text-align: left;"><small>如
果要取得使用者的輸入，可以使用<span style="font-family: Courier New,Courier,monospace; font-weight: bold;">ARGV</span>，
使用者輸入的命令列引數，會收集為字串陣列並給ARGV參考。</small><small>例如：<br>
      </small>
      <ul>
        <li><small>hello.rb</small></li>
      </ul>
      <pre>print "Hello, ", ARGV[0], "\n"</pre>
      <br>
      <small>如下執行指令載入指令稿直譯並執行：</small><small><br>
      </small>
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;
ruby
hello.rb caterpillar</span><br>
Hello!caterpillar!<br>
            <br><span style="font-weight: bold;">
&gt;</span><br>
</span></small><span style="color: rgb(255, 255, 255);">
            </span></td>
          </tr>
        </tbody>
      </table>
    
      <br>
      <small>上面這個範例可以更簡潔地寫為以下：<br>
      </small>
      <ul>
        <li>hello.rb</li>
      </ul>
      <pre>puts "Hello, #{ARGV[0]}"<br></pre>
      <br>
      <small>如果字串中包括<span style="font-weight: bold; font-family: Courier New,Courier,monospace;">#{}</span><span style="font-family: Courier New,Courier,monospace;">，括號中若指定了某個變數名稱，則直譯器會嘗試取得變數值後與字串結合。預設輸出會使用標準輸出<span style="font-weight: bold;">STDOUT</span>，如果想使用標準錯誤輸出，可以指定<span style="font-weight: bold;">STDERR</span>。例如：<br>
      </span></small>
      <ul>
        <li>hello.rb</li>
      </ul>
      <pre>STDERR.print "Hello, #{ARGV[0]}"<br></pre>
      <small><span style="font-family: Courier New,Courier,monospace;"><br>
      </span></small><small>在程式執行的過程中，可以使用<span style="font-family: Courier New,Courier,monospace; font-weight: bold;">gets</span><span style="font-family: Courier New,Courier,monospace;">方法</span>取得使用者的輸入，<span style="font-family: Courier New,Courier,monospace;"></span>使用者輸入文字後按下Enter，<span style="font-family: Courier New,Courier,monospace;">gets</span>會以字串傳回使用者的輸入，取得的字串會包括換行字元。例如：<br>
      </small>
      <ul>
        <li>hello.rb</li>
      </ul>
      <pre>print "Input your name: "<br>name = gets<br>puts "Hello, #{name}!"<br></pre>
      <small><span style="font-family: Courier New,Courier,monospace;"><br>
      </span></small><small>如下執行指令載入指令稿直譯並執行：</small><small><br></small>
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">





        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;ruby main.rb</span><br>
Input your name: Justin<br>
Hello, Justin<br>
!<br>
            <br><span style="font-weight: bold;">
&gt;</span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      </table>
      <br>

      <small>注意最後一個行才出現<span style="font-family: Courier New,Courier,monospace;">!</span>，這是因為<span style="font-family: Courier New,Courier,monospace;">name</span>變數參考的字串，最後包括空白字元。如果想裁剪掉字串前後空白字元，像是換行字元，可以使用字串物件的<span style="font-family: Courier New,Courier,monospace; font-weight: bold;">chomp</span>方法。例如：<br>
      </small>
      <ul>
<li>hello.rb</li>
      </ul>

      <pre>print "Input your name: "<br>name = gets.chomp<br>puts "Hello, #{name}!"<br></pre>

      <small style="font-family: Courier New,Courier,monospace;"><small><br>

      </small>執行結果如下，!會緊接在同一行後，這是因為name變數參考的字串前後空白已被chomp裁掉：</small><small><br></small>
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">






        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;ruby main.rb</span><br>
Input your name: Justin<br>
Hello, Justin!<br>
      <br><span style="font-weight: bold;">
&gt;</span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      </table>

      <br>
      <small>到目前為止，輸出都是使用<span style="font-family: Courier New,Courier,monospace;">print或puts方法，print方法可以使用逗號區隔想輸出的文字，如第一個範例所示，puts也可以，不過要注意，每個文字都會被換行。例如：<br>
</span></small>
      <ul>
        <li>main.rb</li>
      </ul>
      <pre>puts "This ", "is ", "a ", "test", "!"<br></pre>
      <small><span style="font-family: Courier New,Courier,monospace;"><br>
執行結果如下：</span></small><small><br></small>
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">







        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;ruby main.rb</span><br>This<br>
is<br>
a<br>
test<br>
!<br>
<br><span style="font-weight: bold;">
&gt;</span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      </table>


      <br>
      <small style="font-family: Courier New,Courier,monospace;">如果要格式化輸出，可以使用<span style="font-weight: bold;">printf</span>方法。例如：</small><small><br></small>
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">








        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; printf("%d %.2f %s\n", 1, 99.3, "Justin")</span><br>
1 99.30 Justin<br>
=&gt; nil<br><span style="font-weight: bold;">
&gt;&gt;</span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      </table>



      <br>
      <small style="font-family: Courier New,Courier,monospace;">格式化輸出時，所使用的%d、%f、%s等與C語言類似，如果只是要格式化字串，則可以使用<span style="font-weight: bold;">sprintf</span>方法。例如：</small><small><br></small>
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">









        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; x = sprintf "%d %.2f %s", 1, 99.3, "Justin"</span><br>
=&gt; "1 99.30 Justin"<br><span style="font-weight: bold;">
&gt;&gt; puts x</span><br>
1 99.30 Justin<br>
=&gt; nil<br><span style="font-weight: bold;">
&gt;&gt;</span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      </table>




      <br>
      <small>格式化字串另一個簡便的方式，是透過%與陣列，例如：</small><small><br></small>
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">










        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; x = "%d %.2f %s" % [1, 99.3, "Justin"]</span><br>
=&gt; "1 99.30 Justin"<br>
</span></small><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">
&gt;&gt; puts x</span><br>
1 99.30 Justin<br>
=&gt; nil<br><span style="font-weight: bold;">
&gt;&gt;</span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      </table>





      <br>
      <small>如果要將使用者的輸入字串轉換為整數、浮點等型態，可以使用<span style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">to_i</span>、<span style="font-weight: bold;">to_f</span>方法</span>。例如：</small><small><br></small>
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">










        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; "1".to_i</span><br>
=&gt; 1<br><span style="font-weight: bold;">
&gt;&gt; "3.14".to_f</span><br>
=&gt; 3.14<br><span style="font-weight: bold;">
&gt;&gt; "3.14".to_f + 123</span><br>
=&gt; 126.14<br><span style="font-weight: bold;">
&gt;&gt;</span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      </table>





      <br>
      <small style="font-family: Courier New,Courier,monospace;">to_i、to_f方法比較寬鬆，如果字串後段混有非數字部份，只會對數字部份予以剖析，如果不想要這個結果，可以使用Integer或Float。例如：</small><small><br></small>
      
      <table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">











        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small style="font-family: Courier New,Courier,monospace;"><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt; "123one".to_i<br>
</span>=&gt; 123<span style="font-weight: bold;"><br>
&gt;&gt; Integer("123one")<br>
            </span>ArgumentError: invalid value for Integer(): "123one"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from (irb):2:in `Integer'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from (irb):2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from C:/Winware/Ruby192/bin/irb:12:in `&lt;main&gt;'<br>
            <span style="font-weight: bold;">&gt;&gt; "3.14abc".to_f<br>
            </span>=&gt; 3.14<span style="font-weight: bold;"><br>
&gt;&gt; Float("3.14abc")<br>
            </span>ArgumentError: invalid value for Float(): "3.14abc"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from (irb):5:in `Float'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from (irb):5<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from C:/Winware/Ruby192/bin/irb:12:in `&lt;main&gt;'<br>
            <span style="font-weight: bold;">&gt;&gt;</span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      
      </table>






      <br>
<small style="font-family: Courier New,Courier,monospace;">gets方法是從標準輸入<span style="font-weight: bold;">STDIN</span>取得字串，如果想要讀取檔案，可以使用<span style="font-weight: bold;">File.read</span>方法。例如：<br>
      </small>
      <ul>
        <li>main.rb</li>
      </ul>
      <pre>print "File name: "<br>name = gets.chomp<br>content = File.read(name)<br>puts content<br></pre>
      <br>
      <small><span style="font-family: Courier New,Courier,monospace;">File.read會一次讀取檔案所有內容，如果想要逐行讀取檔案內容，可以使用<span style="font-weight: bold;">open</span>方法。例如：</span></small><br>
      <ul>
<li>main.rb</li>
      </ul>

      <pre>print "File name: "<br>name = gets.chomp<br>file = open(name, "r") # "r" 表示檔案供讀取使用<br>while line = file.gets<br>    print line<br>end<br>file.close<br></pre>

      <br>
      <small><span style="font-family: Courier New,Courier,monospace;">gets</span>若讀到檔案結束，會傳回<span style="font-family: Courier New,Courier,monospace;">nil</span>，這在布林判斷時會作為不成立，因此離開迴圈，</small><small><span style="font-family: Courier New,Courier,monospace;">在不使用檔案時，可以使用<span style="font-weight: bold;">close</span>將檔案關閉以節省資源。</span></small><small>另一個比較簡潔的方式，是使用區塊方式撰寫讀取邏輯。例如：<br>
</small>
      <ul>
        <li>main.rb</li>
      </ul>
      <pre>print "File name: "<br>name = gets.chomp<br>file = open(name, "r")<br>file.each do |line|<br>    print line<br>end<br>file.close<br></pre>
      <small><br>
      <span style="font-family: Courier New,Courier,monospace;">open之後傳回的物件，會有each方法，會將讀入的每一行設定給|line|中的line，open本身也有區塊式寫法。例如：</span><br>
      </small>
      <ul>
<li>main.rb</li>
      </ul>


      <pre>print "File name: "<br>name = gets.chomp<br>open(name, "r") do |file|<br>    file.each do |line|<br>        print line<br>    end<br>end<br></pre>

      <br>
      <small style="font-family: Courier New,Courier,monospace;">open之後傳回的物件，會指定給|file|中的file參考，執行完區塊後會自動關閉檔案。區塊寫法牽涉到迭代器等細節，</small><small style="font-family: Courier New,Courier,monospace;">現階段你只要記得有這種寫法，技術細節在之後的文件還會介紹。</small><br>
      <small><br>
      </small><small><span style="font-family: Courier New,Courier,monospace;">如果要寫資料至檔案，則在使用open方法時，指定模式為"w"，並使用<span style="font-weight: bold;">print、puts</span>等方法進行資料寫入。例如：<br>
</span></small><small><span style="font-family: Courier New,Courier,monospace;"></span></small>
      <pre>print "File name: "<br>name = gets.chomp<br>open(name, "w") do |file|<br>    file.print "test"<br>end<br></pre>
      <small><span style="font-family: Courier New,Courier,monospace;"><br>
      如果要以位元組方式讀入檔案，可以使用File實例的each_byte讀入位元組資料，如果要寫出位元組資料至檔案，可以使用File物件的print方法，將包括位元組內容的字串寫出。例如：<br>
</span></small>
      <ul>
        <li>main.rb</li>
      </ul>
      <pre>print "Src: "<br>src = gets.chomp<br>print "Dest: "<br>dest = gets.chomp<br>open(src, "rb") do |r_file|<br>    open(dest, "wb") do |w_file|<br>        r_file.each_byte do |byte|<br>            w_file.print([byte].pack("c*"))<br>        end<br>    end<br>end<br></pre>
      <small><span style="font-family: Courier New,Courier,monospace;">
      </span></small><br>
      <small style="font-family: Courier New,Courier,monospace;">其中b指定用二進位方式開檔，pack是Array實例的方法，指定"c*"表示將位元組資料包裝為字串（</small><small>ASCII-8BIT</small><small style="font-family: Courier New,Courier,monospace;">）。如果需要更低階的操作，可以使用繼承自IO物件的 <a href="http://ruby-doc.org/docs/ProgrammingRuby/html/ref_c_io.html#IO.sysread">sysread</a> 與 <a href="http://ruby-doc.org/docs/ProgrammingRuby/html/ref_c_io.html#IO.syswrite">syswrite</a> 方法。<br>

      <br>
有關於不同編碼的檔案讀寫，則可以參考 </small><small><a href="Encoding.html">關於編碼</a></small><small style="font-family: Courier New,Courier,monospace;">。<br>
      </small><br>
      </td>
    </tr>
  </tbody>
</table>

<br>

<br>

<br>

<br>

<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script>
</body>
<!-- Mirrored from openhome.cc/Gossip/Ruby/BasicIO.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:15:42 GMT -->
</html>