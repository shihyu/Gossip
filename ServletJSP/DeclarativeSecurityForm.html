<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/ServletJSP/DeclarativeSecurityForm.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:17:37 GMT -->
<head>














  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">







  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/print.css" type="text/css">







  
  
  
  
  
  
  
  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>宣告式表單驗證</title></head><body>







<h3><a href="../index.html">From
Gossip@Openhome</a></h3>







<h1><a href="index-2.html">Servlet/JSP Gossip: 宣告式表單驗證<br>
</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>

    <tr>

      <td style="vertical-align: top; width: 250px; text-align: center;">
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>

      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br><script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br></td>

      <td style="vertical-align: top; width: 690px; text-align: left;"><small>接續 </small><small><a href="DeclarativeSecurityBasic.html">宣告式基本驗證</a>。</small><br>
      <small><br>
如果需要自訂登入的畫面，以及登入錯誤時的頁面，則可以改用容器所提供表單（Form）驗證。要將之前的基本驗證改為表單驗證的話，可以在web.xml中修改<span style="font-family: Courier New,Courier,monospace;">&lt;login-config&gt;</span>的設定：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>
&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"<br>
&nbsp;xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br>
&nbsp;xsi:schemaLocation="http://java.sun.com/xml/ns/javaee<br>
&nbsp;http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;</small><small style="font-weight: bold; font-family: Courier New,Courier,monospace;"></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; // 略...</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;login-config&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;auth-method&gt;FORM&lt;/auth-method&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;form-login-config&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;form-login-page&gt;/login.html&lt;/form-login-page&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;form-error-page&gt;/error.html&lt;/form-error-page&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/form-login-config&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;/login-config&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; // 略...</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;/web-app&gt;</small><br>
      </div>
      <small><br>
      <span style="font-family: Courier New,Courier,monospace;">在&lt;auth-method&gt;的設定從BASIC改為<span style="font-weight: bold;">FORM</span>。由於使用表單網頁進行登入，所以必須告訴容器，登入頁面是哪個？登入失敗的頁面又是哪個？這是由<span style="font-weight: bold;">&lt;form-login-page&gt;</span>及<span style="font-weight: bold;">&lt;form-error-page&gt;</span>來設定</span>，設定時注意必須以斜線開始，也就是從應用程式根目錄開始的URL路徑。<br>
      <br>
再來就可以設計自己的表單頁面，但必須注意！表單發送的URL必須是<span style="font-weight: bold; font-family: Courier New,Courier,monospace;">j_security_check</span>，發送名稱的請求參數必須是<span style="font-weight: bold; font-family: Courier New,Courier,monospace;">j_username</span>，發送密碼的請求參數必須是<span style="font-weight: bold; font-family: Courier New,Courier,monospace;">j_password</span>。以下是個簡單的示範：<br>
      </small>
      <pre>&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;<br>&lt;html&gt;<br>  &lt;head&gt;<br>    &lt;title&gt;登入&lt;/title&gt;<br>    &lt;meta http-equiv="Content-Type"<br>            content="text/html; charset=UTF-8"&gt;<br>  &lt;/head&gt;<br>  &lt;body&gt;<br>    &lt;form action="<span style="font-weight: bold;">j_security_check</span>" method="post"&gt;<br>        名稱：&lt;input type="text" name="<span style="font-weight: bold;">j_username</span>"&gt;&lt;br&gt;<br>        密碼：&lt;input type="password" name="<span style="font-weight: bold;">j_password</span>"&gt;&lt;br&gt;<br>        &lt;input type="submit" value="送出"&gt;<br>    &lt;/form&gt;<br>  &lt;/body&gt;<br>&lt;/html&gt; <br></pre>
      <br>
      <small>一但使用者驗證成功，<span style="font-family: Courier New,Courier,monospace;">HttpSession的逾時或失效（呼叫invalidate()方法），使用者就相當於登出。</span></small><br>
      <br>
      <small>除了基本驗證與表單驗證之外，<span style="font-family: Courier New,Courier,monospace;">在&lt;auth-method&gt;中還可以設定<span style="font-weight: bold;">DIGEST</span>或<span style="font-weight: bold;">CLIENT-CERT</span></span>。<br>
      <br>
      <span style="font-family: Courier New,Courier,monospace;">DIGEST即所謂「摘要驗證」，瀏覽器也會出現對話方塊輸入名稱、密碼，而後透過Authorization</span>標
頭傳送，只不過並非使用BASE64來編碼名稱、密碼。瀏覽器會直接傳送名稱，但對密碼則先進行（MD5）摘要演算（非加密），得到理論上唯一且不可逆的
字串再傳送，伺服端根據名稱從後端取得密碼，以同樣的方式作摘要演算，再比對瀏覽器送來的摘要字串是否符合，如果符合就驗證成功。由於網路上傳送時並不是
真正的密碼，而是不可逆的摘要，密碼不會被得知，理論上比較安全一些。<br>
      <br>
      <span style="font-family: Courier New,Courier,monospace;">CLIENT-CERT</span>也是用對話方塊的方式來輸入名稱與密碼，因為使用PKC（Public Key Certificate）作加密，可保證資料傳送時的機密性及完整性，但客戶端需要安裝憑證（Certificate），在一般使用者及應用程式之間並不常採用。<br>
      <br>
在身份驗證的四種方式中，<span style="font-family: Courier New,Courier,monospace;">BASIC、FORM、DIGEST都無法保證資料的機密性與完整性（DIGEST比較安全一點，但這個機制畢竟不是加密）。CLIENT-CERT</span>利用PKC加密，但客戶端要安裝憑證，比較不適用於一般使用者及應用程式之間的資料傳送。<br>
      <br>
通常Web應用程式要在傳輸過程中保護資料，會採用<span style="font-weight: bold;">HTTP over SSL</span>，就就是俗稱的<span style="font-weight: bold;">HTTPS</span>。在HTTPS中，伺服端會提供憑證來證明自己的身份及提供加密用的公鑰，而瀏覽器會利用公鑰加密資訊再傳送給伺服端，伺服端再用對應的私鑰進行解密以取得資訊，客戶端本身不用安裝憑證，因此是在保護資料傳送上是最常採用的方式。<br>
      <br>
如果要使用HTTPS來傳輸資料，則只要在web.xml中需要安全傳輸的<span style="font-family: Courier New,Courier,monospace;">&lt;security-contraint&gt;</span>中設定：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&lt;user-data-constraint&gt;</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&lt;/user-data-constraint&gt;</span></small><br style="font-weight: bold;">
      </div>
      <small><br>
      <span style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&lt;transport-guarantee&gt;</span>預設值是NONE，還可以設定的值是<span style="font-weight: bold;">CONFIDENTIAL</span>或<span style="font-weight: bold;">INTEGRAL</span>，
正如其名稱所表達的，CONFIDENTIAL在保證資料的機密性，也就是資料不可被未經驗證、授權的其他人看到，而INTEGRAL在保證完整性，也就
是資料不可以被第三方修改。事實上，無論設定CONFIDENTIAL或INTEGRAL，都可以保證機密性與完整性，只是大家慣例上都設定
CONFIDENTIAL。</span><br>
      <br>
可以為之前的表單驗證設定使用HTTPS：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>
&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"<br>
&nbsp;xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br>
&nbsp;xsi:schemaLocation="http://java.sun.com/xml/ns/javaee<br>
&nbsp;http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;</small><small style="font-weight: bold; font-family: Courier New,Courier,monospace;"></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; // 略...</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;security-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;web-resource-collection&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;web-resource-name&gt;Admin&lt;/web-resource-name&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/web-resource-collection&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;auth-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;role-name&gt;admin&lt;/role-name&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/auth-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;user-data-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/user-data-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;/security-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;security-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;web-resource-collection&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;web-resource-name&gt;Manager&lt;/web-resource-name&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;url-pattern&gt;/manager/*&lt;/url-pattern&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;http-method&gt;GET&lt;/http-method&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;http-method&gt;POST&lt;/http-method&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/web-resource-collection&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;auth-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;role-name&gt;admin&lt;/role-name&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;role-name&gt;manager&lt;/role-name&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/auth-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;user-data-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace; color: red;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/user-data-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; &lt;/security-constraint&gt;</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp; // 略...</small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-weight: bold; font-family: Courier New,Courier,monospace;">&lt;/web-app&gt; </small><br>
      </div>
      <small><br>
就Web應用程式來說，只要這樣設定就夠了！若伺服器有支援SSL且安裝好憑證，當你請求受保護的資源時，伺服器會要求瀏覽器重新導向使用https。</small><br>
<br>
</td>

    </tr>

  </tbody>
</table>

<br>
<br>

<br>

<br>







<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script></body>
<!-- Mirrored from openhome.cc/Gossip/ServletJSP/DeclarativeSecurityForm.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:17:37 GMT -->
</html>