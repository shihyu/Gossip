<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/ServletJSP/RequestParameterHeader.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:16:53 GMT -->
<head>























  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">







  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/print.css" type="text/css">







  
  
  
  
  
  
  
  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>請求參數、標頭</title></head><body>







<h3><a href="../index.html">From
Gossip@Openhome</a></h3>







<h1><a href="index-2.html">Servlet/JSP Gossip: 請求參數、標頭<br>
</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>

    <tr>

      <td style="vertical-align: top; width: 250px; text-align: center;">
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>

      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br><script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br></td>

      <td style="vertical-align: top; width: 690px; text-align: left;"><small>當請求來到伺服器時，Web容器會建立<span style="font-family: Courier New,Courier,monospace;">HttpServletRequest實例來包裝請求中的相關訊息，HttpServletRequest定義了取得一些通用請求資訊的方法，例如若請求</span>URI<span style="font-family: Courier New,Courier,monospace;">上的請求參數，則可以使用以下的方法來取得：</span></small><br>
      <ul style="font-weight: bold;">
        <li><small><span style="font-family: Courier New,Courier,monospace;">getParameter()</span></small></li>
      </ul>
      <div style="margin-left: 40px;"><small>指定請求參數名稱來取得對應的值，例如：<br>
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">String username = request.getParameter("name");<br>
      <br>
      </span><span style="font-family: Courier New,Courier,monospace;">getParameter()傳回的是String物件，若傳來的是像"123"這樣的字串值，而你需要的是基本資料型態，則必須使用Integer.parseInt()這類的方法將之剖析為基本型態。若請求中沒有所指定的請求參數名稱，則會傳回null。&nbsp;</span><br style="font-family: Courier New,Courier,monospace;">
      </small></div>
      <br style="font-family: Courier New,Courier,monospace;">
      <ul style="font-family: Courier New,Courier,monospace; font-weight: bold;">
        <li><small>getParameterValues()</small></li>
      </ul>
      <div style="margin-left: 40px;"><small>如果表單上有可複選的元件，例如核取方塊（Checkbox）、清單（List）等，則同一個請求參數名稱會有多個值（此時的HTTP查詢字串其實就是像<span style="font-family: Courier New,Courier,monospace;">param=10&amp;param=20&amp;param=30</span>），此時你可以用<span style="font-family: Courier New,Courier,monospace;">getParameterValues()</span>方法取得一個<span style="font-family: Courier New,Courier,monospace;">String</span>陣列，陣列元素代表所有被選取選項的值。例如：<br>
      <span style="font-weight: bold; font-family: Courier New,Courier,monospace;">String[] values = request.getParameterValues("param"); </span><br>
      </small></div>
      <br>
      <ul style="font-family: Courier New,Courier,monospace; font-weight: bold;">
        <li><small>getParameterNames()</small></li>
      </ul>
      <div style="margin-left: 40px;"><small><span style="font-family: Courier New,Courier,monospace;">如果想要知道請求中有多少請求參數，則可以使用getParameterNames()方法，這會傳回一個Enumeration物件，當中包括所有的請求參數名稱。例如：<br>
      <span style="font-weight: bold;">Enumeration&lt;String&gt; e = req.getParameterNames();</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">while(e.hasMoreElements()) {</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; String param = e.nextElement();</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; ..</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">}</span><br>
      </span></small></div>
      <br>
      <ul style="font-family: Courier New,Courier,monospace; font-weight: bold;">
        <li><small>getParameterMap()</small></li>
      </ul>
      <div style="margin-left: 40px;"><small>將請求參數以<span style="font-family: Courier New,Courier,monospace;">Map物件傳回，Map</span>中的鍵（Key）是請求參數名稱，值（Value）的部份是請求參數值，以字串陣列型態<span style="font-family: Courier New,Courier,monospace;">String[]</span>傳回（考慮有同一請求參數有多個值的情況）。</small><br>
      </div>
      <br style="font-family: Courier New,Courier,monospace;">
      <small>對於HTTP的標頭（Header）資訊，可以使用以下的方法來取得：</small><br>
      <ul style="font-weight: bold;">
        <li><small style="font-family: Courier New,Courier,monospace;">getHeader()</small></li>
      </ul>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;">使用方式與getParameter()類似，指定標頭名稱後可傳回字串值，代表瀏覽器所送出的標頭訊息。</small><br>
      </div>
      <br>
      <ul style="font-weight: bold;">
        <li><small style="font-family: Courier New,Courier,monospace;">getHeaders()</small></li>
      </ul>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;">使用方式與getParameterValues()類似，指定標頭名稱後可傳回Enumeration，元素為字串。</small><br>
      </div>
      <small style="font-family: Courier New,Courier,monospace;"><br>
      </small>
      <ul style="font-weight: bold;">
        <li><small style="font-family: Courier New,Courier,monospace;">getHeaderNames()</small></li>
      </ul>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;">使用方式與getParameterNames()類似，取得所有標頭名稱，以Enumeration傳回，內含所有標頭字串名稱。</small><br>
      </div>
      <br>
      <small>下面這個範例示範了如何取得並顯示瀏覽器送出的標頭訊息：</small><br style="font-family: Courier New,Courier,monospace;">
      <pre>package cc.openhome;<br><br>import java.io.*;<br>import java.util.*;<br>import javax.servlet.*;<br>import javax.servlet.annotation.*;<br>import javax.servlet.http.*;<br><br>@WebServlet(name = "ShowHeader", urlPatterns = {"/header.view"})<br>public class ShowHeader extends HttpServlet {<br>    @Override<br>    protected void doGet(HttpServletRequest req, HttpServletResponse resp)<br>            throws ServletException, IOException {<br>        PrintWriter out = resp.getWriter();<br>        out.println("&lt;html&gt;");<br>        out.println("&lt;head&gt;");<br>        out.println("&lt;title&gt;Servlet ShowHeader&lt;/title&gt;");<br>        out.println("&lt;/head&gt;");<br>        out.println("&lt;body&gt;");<br>        Enumeration names = req.getHeaderNames();<br>        while (names.hasMoreElements()) {<br>            String name = (String) names.nextElement();<br>            out.println(name + ": " + req.getHeader(name) + "&lt;br&gt;");<br>        }<br>        out.println("&lt;/body&gt;");<br>        out.println("&lt;/html&gt;");<br>        out.close();<br>    }<br>}<br></pre>
      <br style="font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;">如果標頭值本身
是個整數或日期的字串表示法，則可以使用<span style="font-weight: bold;">getIntHeader()</span>或<span style="font-weight: bold;">getDateHeader()</span>方法分別取得轉換為int或Date的值。如果
getIntHeader()無法轉換為int，則會丟出NumberFormatException，如果getDateHeader()無法轉換為
Date，則會丟出IllegalArgumentException。</small><br>
      <br><small>如果客戶端沒有在<span style="font-family: Courier New,Courier,monospace;">Content-Type</span>標頭中設定字元編碼資訊（例如<span style="font-family: Courier New,Courier,monospace;">Content-Type: text/html; charset=UTF-8</span>），</small><small>此時使用<span style="font-family: Courier New,Courier,monospace;">HttpServletRequest的<span style="font-weight: bold;">getCharacterEncoding()</span></span>傳回值會是<span style="font-family: Courier New,Courier,monospace;">null</span>，而</small><small>容器所使用的預設編碼處理是<a href="http://www.w3schools.com/tags/ref_entities.asp"><span style="font-weight: bold;">ISO-8859-1</span></a><span style="font-weight: bold;"></span></small><small>（大部份瀏覽器預設的字元集）</small><small><a href="http://www.w3schools.com/tags/ref_entities.asp"><span style="font-weight: bold;"></span></a>，所以，在這個情況下，如果你的客戶端使用UTF-8發送非ASCII字元的請求參數，而你的Servlet直接取得該請求參數值，就會是不正確的結果（亂碼）。</small><small><br>
      <br>
你可以使用<span style="font-family: Courier New,Courier,monospace;">HttpServletRequest的<span style="font-weight: bold;">setCharacterEncoding()</span></span>方法來指定取得請求參數時所使用的編碼。例如若瀏覽器以UTF-8來發送請求，則你接收時也使用UTF-8編碼字串，則可以在取得任何請求值之<span style="font-weight: bold;">「前」</span>，執行以下陳述：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">req.setCharacterEncoding("UTF-8");</span></small><br>
      </div>
      <small><br>
不過要注意，在規格書中對<a href="http://download.oracle.com/javaee/6/api/javax/servlet/ServletRequest.html#setCharacterEncoding%28java.lang.String%29"><span style="font-family: Courier New,Courier,monospace;"> setCharacterEncoding() </span></a>清楚提到其作用為：<br>
</small>
      <div style="margin-left: 40px;"><small><span style="font-weight: bold;">Overrides the name of the character encoding used in the body of this request.</span></small><br>
      </div>
      <small><br>
也就是說，基本上這個方法只對POST產生作用，當請求是用GET發送時則沒有定義是否一定要有作用（究其原因，是因為處理URL的是HTTP伺服器，而非容器）。<br>
      <br>
例如</small><small>Tomcat在<span style="font-weight: bold;">GET</span>時，使用</small><small>請求物件的<span style="font-family: Courier New,Courier,monospace;">setCharacterEncoding()</span>方法設定編碼就不會有作用，在Tomcat中若為GET時，仍會產生亂碼。<br>
<br>若你使用Tomcat並採用GET，或你沒有設定<span style="font-family: Courier New,Courier,monospace;">setCharacterEncoding()</span>，且已取得一個請求參數字串，另外一個處理編碼的方式，則是透過<span style="font-family: Courier New,Courier,monospace;">String的getBytes()</span>取得指定編碼來取得該字串的位元組陣列，然後再重新建構UTF-8編碼的字串。例如若確定來源字串是ISO-8859-1，想轉換為UTF-8編碼：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">String username = req.getParameter("name");</small><br style="font-family: Courier New,Courier,monospace; font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace; font-weight: bold;">String username = new String(</small><small style="font-family: Courier New,Courier,monospace; font-weight: bold;">username.getBytes("ISO-8859-1"), "UTF-8");</small><br>
      </div>
      <small><br>
<br>
另外還有一點要注意，如果你的.java原始碼檔案中撰寫了中文字串，必須確認一下你所使用的IDE或編輯器預設的文字編碼，以及編譯時是否指定了正確的
編碼，否則在編譯時無法正確地解釋中文字元，最後都會造成顯示時字元的亂碼。以NetBeans IDE為例，編輯器預設的文字編碼格式都是UTF-8。</small><br>
      <br>
      <br style="font-family: Courier New,Courier,monospace;">
<br style="font-family: Courier New,Courier,monospace;">
</td>

    </tr>

  </tbody>
</table>

<br>
<br>

<br>

<br>







<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script></body>
<!-- Mirrored from openhome.cc/Gossip/ServletJSP/RequestParameterHeader.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:16:53 GMT -->
</html>