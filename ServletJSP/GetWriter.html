<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/ServletJSP/GetWriter.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:16:53 GMT -->
<head>















  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">







  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/print.css" type="text/css">







  
  
  
  
  
  
  
  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>getWriter()</title></head><body>







<h3><a href="../index.html">From
Gossip@Openhome</a></h3>







<h1><a href="index-2.html">Servlet/JSP Gossip: getWriter()<br>
</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>

    <tr>

      <td style="vertical-align: top; width: 250px; text-align: center;">
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>

      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br><script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br></td>

      <td style="vertical-align: top; width: 690px; text-align: left;"><small style="font-family: Courier New,Courier,monospace;">你可以從HttpServletResponse的<span style="font-weight: bold;">getWriter()</span>取得PrintWriter物件，透過該物件對客戶端進行字元輸出。在沒有設定任何內容型態或編碼之前，容器所使用的字元編碼是<span style="font-weight: bold;">ISO-8859-1</span>。<br>
      <br>
你可以使用HttpServletResponse的<span style="font-weight: bold;">setLocale()</span>來設定地區（Locale）資訊，setLocale()必須在回應確認前設定，回應確認後設定地區資訊並沒有效果。容器如何與客戶端溝通並沒有規範，通常使用Content-Language標頭來設定。例如以下會將</small><small>HTTP</small><small style="font-family: Courier New,Courier,monospace;">回應的Content-Language設定為zh-TW：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">resp.setLocale(Locale.TAIWAN);</span></small><br>
      </div>
      <small style="font-family: Courier New,Courier,monospace;"><br>
你可以使用HttpServletResponse的<span style="font-weight: bold;">getCharacterEncoding()</span>方法取得編碼設定，</small><small style="font-family: Courier New,Courier,monospace;">上面的例子設定過後，預設編碼是Big5，你可以在</small><small>web.xml</small><small style="font-family: Courier New,Courier,monospace;">中設定區域與編碼的對應。例如：<br>
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; &lt;locale-encoding-mapping-list&gt;</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;locale-encoding-mapping&gt;</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;locale&gt;zh_TW&lt;/locale&gt;</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/locale-encoding-mapping&gt;</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; &lt;/locale-encoding-mapping-list&gt;</span><br>
      </small><br>
      <small style="font-family: Courier New,Courier,monospace;">則在若搭配先前的程式片段，或者是以下的程式片段，getCharacterEncoding()取得的就是UTF-8：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">resp.setLocale(new Locale("zh", "TW"));</span></small><br>
      </div>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">你也可以呼叫HttpServletResponse的<span style="font-weight: bold;">setCharacgerEncoding()</span>設定字元編碼：</small><br>
      <div style="margin-left: 40px;"><small style="font-weight: bold;"><span style="font-family: Courier New,Courier,monospace;">resp.setCharacterEncoding("UTF-8");</span></small><br>
      </div>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">或者是在使用HttpServletResponse的<span style="font-weight: bold;">setContentType()</span>時，指定<span style="font-weight: bold;">charset</span>，charset的值會用來呼叫setCharacterEncoding()。例如：</small><br>
      <div style="margin-left: 40px;"><small><span style="font-weight: bold; font-family: Courier New,Courier,monospace;">resp.setContentType("text/html; charset=UTF-8");</span></small><br>
      </div>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">如果使用了setCharacterEncoding()或setContentType()時指定了charset，則setLocale()就會被忽略。</small><br>
      <br>
      <small>結合</small><big> </big><small><a href="RequestParameterHeader.html"><small><big>請求參數、標頭</big></small></a> 與這邊的說明，可以得知的是，如果你要可以接收中文請求參數並在回應時於瀏覽器顯示出來，必須設定<span style="font-family: Courier New,Courier,monospace;">HttpServletRequest的setCharacterEncoding()以及HttpServletResponse的setCharacterEncoding()或setContentType()</span>為正確的編碼。<br>
      <br>
例如&nbsp; 以下這個範例，可以讓你透過表單發送中文請求參數值，Servlet可正確地接收處理並顯示在結果畫面上。你可以使用表單發送名稱、郵件與多選喜愛的寵物類型代表。首先是表單的部份：：<br>
      </small>
      <pre>&lt;html&gt;<br>    &lt;head&gt;<br>        &lt;title&gt;寵物類型大調查&lt;/title&gt;<br>        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;<br>    &lt;/head&gt;<br>    &lt;body&gt;<br>        &lt;form action="pet.view" method="post"&gt;<br>            姓名：&lt;input type="text" name="user" value=""&gt;&lt;br&gt;<br>            郵件：&lt;input type="text" name="email" value=""&gt;&lt;br&gt;<br>            你喜愛的寵物代表：&lt;br&gt;<br>            &lt;select name="type" size="6" multiple="true"&gt;<br>                &lt;option value="貓"&gt;貓&lt;/option&gt;<br>                &lt;option value="狗"&gt;狗&lt;/option&gt;<br>                &lt;option value="魚"&gt;魚&lt;/option&gt;<br>                &lt;option value="鳥"&gt;鳥&lt;/option&gt;<br>            &lt;/select&gt;&lt;br&gt;<br>            &lt;input type="submit" value="送出"/&gt;<br>        &lt;/form&gt;<br>    &lt;/body&gt;<br>&lt;/html&gt; <br></pre>

      <br>
      <small>接著是Servlet的部份：<br>
      </small>
      <pre>package cc.openhome;<br><br>import java.io.*;<br>import javax.servlet.*;<br>import javax.servlet.annotation.*;<br>import javax.servlet.http.*;<br><br>@WebServlet(name="Pet", urlPatterns={"/pet.view"})<br>public class Pet extends HttpServlet {<br>    @Override<br>    protected void doPost(HttpServletRequest request,<br>                         HttpServletResponse response)<br>            throws ServletException, IOException {<br><span style="font-weight: bold;">        request.setCharacterEncoding("UTF-8");</span><br style="font-weight: bold;"><span style="font-weight: bold;">        response.setContentType("text/html; charset=UTF-8");</span><br style="font-weight: bold;"><br>        PrintWriter out = response.getWriter();<br>        out.println("&lt;html&gt;");<br>        out.println("&lt;head&gt;");<br>        out.println("&lt;title&gt;感謝&lt;/title&gt;");<br>        out.println("&lt;/head&gt;");<br>        out.println("&lt;body&gt;");<br>        out.println("聯絡人：&lt;a href=\"mailto:"+<br>                request.getParameter("email") + "\"&gt;" +<br>                request.getParameter("user") + "&lt;/a&gt;");<br>        out.println("&lt;br&gt;喜愛的寵物類型");<br>        out.println("&lt;ul&gt;");<br>        for(String type : request.getParameterValues("type")) {<br>            out.println("&lt;li&gt;" + type + "&lt;/li&gt;");<br>        }<br>        out.println("&lt;/ul&gt;");<br>        out.println("&lt;/body&gt;");<br>        out.println("&lt;/html&gt;");<br>        out.close();<br>    }<br>}<br></pre>
      <br>
      <small>實際上若頁面很多，逐個頁面設定編碼是件很麻煩的事，所以設定編碼的動作其實不會直接在Servlet中進行，而會在過濾器（Filter）中設定，之後還會談到過濾器的細節。</small><br>
      <br>
<br>
</td>

    </tr>

  </tbody>
</table>

<br>
<br>

<br>

<br>







<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script></body>
<!-- Mirrored from openhome.cc/Gossip/ServletJSP/GetWriter.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:16:53 GMT -->
</html>