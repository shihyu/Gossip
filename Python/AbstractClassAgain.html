<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from openhome.cc/Gossip/Python/AbstractClassAgain.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:15:42 GMT -->
<head>











  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/stdlayout.css" type="text/css">







  
  
  
  
  
  
  
  <link rel="stylesheet" href="css/print.css" type="text/css">







  
  
  
  
  
  
  
  <meta content="text/html; charset=Big5" http-equiv="content-type"><title>再看抽象類別</title></head><body>







<h3><a href="../index.html">From
Gossip@Openhome</a></h3>







<h1><a href="index-2.html">Python Gossip: 再看抽象類別<br>
</a></h1>

<table style="text-align: left; width: 946px; height: 32px;" border="0" cellpadding="0" cellspacing="0">

  <tbody>

    <tr>

      <td style="vertical-align: top; width: 250px; text-align: center;"> <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br>
      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br>

      <br>

      <script type="text/javascript"><!--
google_ad_client = "pub-9750319131714390";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
      </script>
      <script type="text/javascript" src="../../../pagead2.googlesyndication.com/pagead/show_ads.js">
      </script><br><br><center> </center></td>

      <td style="vertical-align: top; width: 690px; text-align: left;"><small>在</small> <small><a href="AbstractClass.html">抽象類別</a> 中曾經討論過定義抽象類別的幾個方式，其中提及，可以使用<span style="font-family: Courier New,Courier,monospace;">abc模組中的ABCMeta及abstractmethod</span>來協助定義抽象類別：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">import random</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">from abc import ABCMeta, abstractmethod</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">class GuessGame(metaclass=ABCMeta):</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; @abstractmethod</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; def message(self, msg):</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pass</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; @abstractmethod</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; def guess(self):</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pass&nbsp;&nbsp;&nbsp;&nbsp; </span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; 略...</span></small><br>
      </div>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">其中ABCMeta就是個metaclass，而abstractmethod是個修飾器，在了解它們的實作之前，可以先了解，你可以定義類別的<span style="font-weight: bold;">__abstractmethods__</span>，指明某些特性是抽象方法。例如：</small><small><br></small>
      <table style="text-align: left; width: 100%; font-family: Courier New,Courier,monospace;" border="0" cellpadding="2" cellspacing="2">





        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt;&gt; class AbstractX:<br>
...&nbsp;&nbsp;&nbsp;&nbsp; def doSome(self):<br>
...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pass<br>
...&nbsp;&nbsp;&nbsp;&nbsp; def doOther(self):<br>
...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pass<br>
...<br>
&gt;&gt;&gt; AbstractX.__abstractmethods__ = frozenset({'doSome', 'doOther'})<br>
&gt;&gt;&gt; x = AbstractX()<br>
</span>Traceback (most recent call last):<br>
&nbsp; File "&lt;stdin&gt;", line 1, in &lt;module&gt;<br>
TypeError: Can't instantiate abstract class AbstractX with abstract methods doOther, doSome<span style="font-weight: bold;"><br>
&gt;&gt;&gt;</span></span></small><span style="color: rgb(255, 255, 255);"><br>




            </span></td></tr></tbody>
      </table>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">在類別建立之後，指定其__abstractmethods__特性，</small><small style="font-family: Courier New,Courier,monospace;">__abstractmethods__接受集合物件，集合物件中的字串表明哪些方法是抽象方法，如果一個類別的</small><small style="font-family: Courier New,Courier,monospace;">__abstractmethods__集合物件不為空，那它是個抽象類別，不可以直接實例化。<br>
      <br>
      </small><small style="font-family: Courier New,Courier,monospace;">子類別不會看的到父類別的</small><small style="font-family: Courier New,Courier,monospace;">__abstractmethods__。例如：</small><small><br></small>
      <table style="text-align: left; width: 100%; font-family: Courier New,Courier,monospace;" border="0" cellpadding="2" cellspacing="2">






        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt;&gt; class ConcreteX(AbstractX):<br>
...&nbsp;&nbsp;&nbsp;&nbsp; pass<br>
...<br>
&gt;&gt;&gt; x = ConcreteX()<br>
&gt;&gt;&gt; ConcreteX.__abstractmethods__<br>
</span>Traceback (most recent call last):<br>
&nbsp; File "&lt;stdin&gt;", line 1, in &lt;module&gt;<br>
AttributeError: __abstractmethods__<span style="font-weight: bold;"><br>
&gt;&gt;&gt;<br>
            </span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);">




            </span></td></tr></tbody>
      </table>

      <br>
      <small>所以子類別若沒有實作父類別所有抽象方法，若亦想要定義抽象方法，則必須定義自己的<span style="font-family: Courier New,Courier,monospace;">__abstractmethods__。</span>例如：</small><small><br></small>
      <table style="text-align: left; width: 100%; font-family: Courier New,Courier,monospace;" border="0" cellpadding="2" cellspacing="2">







        <tbody>




          <tr>




            <td style="background-color: rgb(0, 0, 0);"><small><span style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">&gt;&gt;&gt; class SubAbsX(AbstractX):<br>
...&nbsp;&nbsp;&nbsp;&nbsp; def doSome(self):<br>
...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print('Some')<br>
...<br>
&gt;&gt;&gt; SubAbsX.__abstractmethods__ = frozenset({'doOther'})<br>
&gt;&gt;&gt; x = SubAbsX()</span><br>
Traceback (most recent call last):<br>
&nbsp; File "&lt;stdin&gt;", line 1, in &lt;module&gt;<br>
TypeError: Can't instantiate abstract class SubAbsX with abstract methods doOther<span style="font-weight: bold;"><br>
&gt;&gt;&gt;</span><span style="font-weight: bold;"><br>
      </span><span style="font-weight: bold;"></span></span></small><span style="color: rgb(255, 255, 255);">




            </span></td></tr></tbody>
      </table>


      <br>
      <small>了解以下之後，可以嘗試實作一個簡單的ABCMeta及abstractmethod：<br>
      </small>
      <pre>def abstract(func):<br>    func.__isabstract__ = True<br>    return func<br>    <br>class Abstract(type):<br>    def __new__(metaclz, definedclzname, supers, attrs):<br>        clz = type.__new__(metaclz, definedclzname, supers, attrs)<br>        # 這個類別自己定義的抽象方法<br>        abstracts = {name<br>                     for name, value in attrs.items()<br>                     if getattr(value, "__isabstract__", False)}<br>        # 從父類別中繼承下來的抽象方法<br>        for super in supers:<br>            for name in getattr(super, "__abstractmethods__", set()):<br>                value = getattr(clz, name, None)<br>                # 如果類別有定義自己的方法，則該方法就不會有 __isabstract__<br>                # 就不會被加入 abstracts<br>                if getattr(value, "__isabstract__", False):<br>                    abstracts.add(name)<br>        <br>        # 這個類別總共的抽象方法        <br>        clz.__abstractmethods__ = frozenset(abstracts)<br>        <br>        return clz<br></pre>
      <br>
      <small>你可以這麼使用：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">class AbstractX(metaclass=Abstract):</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; @abstract</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; def doSome(self):</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pass<br>
      <br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      </span></small><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;"># Can't instantiate abstract class AbstractX with abstract methods doSome</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">x = AbstractX() </span></small><br>
      </div>
      <br>
      <small>子類別也必須定義所有的抽象方法：<br>
      </small>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">class SubAbstractX(AbstractX):</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; pass</span></small><br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;"><br>
# Can't instantiate abstract class SubAbstractX with abstract methods doSome<br style="font-weight: bold; font-family: Courier New,Courier,monospace;">
      </span></small><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">x = SubAbstractX()</span></small><br style="font-weight: bold;">
      </div>
      <br>
      <small>只有在實作所有抽象方法時，才可以實例化：</small><br>
      <div style="margin-left: 40px;"><small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">class ConcreteX(AbstractX):</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; def doSome(self):</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print('XD')</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; </span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">x = ConcreteX()</span></small><br style="font-weight: bold;">
      <small style="font-family: Courier New,Courier,monospace;"><span style="font-weight: bold;">x.doSome()</span></small><br>
      </div>
      <br>
<br>
</td>

    </tr>

  </tbody>
</table>

<br>
<br>

<br>

<br>







<script src="../../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-143766-1";
urchinTracker();
</script></body>
<!-- Mirrored from openhome.cc/Gossip/Python/AbstractClassAgain.html by HTTrack Website Copier/3.x [XR&CO'2008], Sun, 28 Jul 2013 09:15:42 GMT -->
</html>